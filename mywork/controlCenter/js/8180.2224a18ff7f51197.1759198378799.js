(self["webpackChunkcontrol_center"]=self["webpackChunkcontrol_center"]||[]).push([[8180],{56695:function(e,t,a){var n=a(66634);n.__esModule&&(n=n.default),"string"===typeof n&&(n=[[e.id,n,""]]),n.locals&&(e.exports=n.locals);var l=a(68459).A;l("76240c80",n,!0,{sourceMap:!1,shadowMode:!1})},66634:function(e,t,a){"use strict";a.r(t);var n=a(31601),l=a.n(n),o=a(76314),i=a.n(o),s=i()(l());s.push([e.id,".panelContent[data-v-1596a50f]{height:100%;padding:0 20px 20px}.panelContent .contentWrapper[data-v-1596a50f]{height:100%;padding:0}.panelContent .btnWrap[data-v-1596a50f]{padding:0 0 10px;height:42px;display:flex;justify-content:flex-end}.panelContent .btnWrap[data-v-1596a50f] .downloadExcel{margin:0 10px}",""]),t["default"]=s},88180:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return C}});var n=a(56768),l=a(45130);const o={class:"panelContent"},i={class:"contentWrapper",ref:"view"},s={class:"searchBlock",ref:"searchBlock"},d={class:"btnWrap"},c={class:"tableSection"},r={class:"buttonWrapper"};function p(e,t,a,p,u,h){const f=(0,n.g2)("el-button"),g=(0,n.g2)("DownloadExcel"),b=(0,n.g2)("el-upload"),v=(0,n.g2)("TableWrapper");return(0,n.uX)(),(0,n.CE)("div",o,[(0,n.Lk)("div",i,[(0,n.Lk)("div",s,[(0,n.Lk)("div",d,[p.selected.length>0?((0,n.uX)(),(0,n.CE)(n.FK,{key:0},[(0,n.bF)(f,{type:"danger",plain:"",icon:"close",onClick:p.deleteSelected},{default:(0,n.k6)(()=>[...t[1]||(t[1]=[(0,n.eW)("刪除已選",-1)])]),_:1},8,["onClick"]),(0,n.bF)(g,{class:"downloadExcel",datas:[p.downloadData],columnSetting:[p.downloadColumn],"file-name":"預設群組設定","sheet-name":["預設群組設定"]},{default:(0,n.k6)(()=>[(0,n.bF)(f,{type:"warning",plain:"",icon:"Download"},{default:(0,n.k6)(()=>[...t[2]||(t[2]=[(0,n.eW)("匯出已選",-1)])]),_:1})]),_:1},8,["datas","columnSetting"])],64)):(0,n.Q3)("",!0),(0,n.bF)(b,{action:"","show-file-list":!1,"http-request":p.openImportPreviewCheck,"before-upload":p.beforeUpload},{default:(0,n.k6)(()=>[(0,n.bF)(f,{type:"primary",plain:"",icon:"Upload",loading:p.loading,onClick:t[0]||(t[0]=(0,l.D$)(()=>{},["prevent","self"]))},{default:(0,n.k6)(()=>[...t[3]||(t[3]=[(0,n.eW)("匯入",-1)])]),_:1},8,["loading"])]),_:1},8,["http-request","before-upload"])])],512),(0,n.Lk)("div",c,[(0,n.bF)(v,{tableHeight:p.tableHeight,tableWidth:p.tableWidth,tableData:p.tableList,columnSetting:p.columnSetting,listLoading:p.listLoading,hasSelected:""},null,8,["tableHeight","tableWidth","tableData","columnSetting","listLoading"])])],512),(0,n.Lk)("div",r,[(0,n.bF)(f,{type:"danger",onClick:p.closePanel},{default:(0,n.k6)(()=>[...t[4]||(t[4]=[(0,n.eW)("取消",-1)])]),_:1},8,["onClick"])])])}a(44114),a(18111),a(20116),a(7588),a(61701);var u=a(90144),h=a(12933),f=a(51219),g=a(4249),b=a(78626),v=a(44189),m=a(84055),k={name:"EditGroup",setup(e,{emit:t}){const l=(0,u.ref)(!1),o=(0,u.ref)(""),i=(0,u.ref)([]),s=(0,u.ref)(0),d=(0,u.ref)(void 0),c=(0,u.ref)(0),r=(0,g.Pj)(),p=(0,n.EW)(()=>C.value.map(e=>{const t=(0,b.cloneDeep)(e);return delete t.id,t.children=JSON.stringify(e.children),t})),k=async()=>{l.value=!0;try{i.value=await m.A.getList({ordering:o.value})}catch{}finally{l.value=!1}},{searchBlock:w,view:y,selected:C}=(0,v.Ay)({getList:k}),x=[{prop:"title",label:"名稱",width:200},{prop:"category",label:"分類",width:120},{prop:"description",label:"描述"}],W=(0,b.cloneDeep)(x);W.push({prop:"children",label:"children"},{prop:"height",label:"height"},{prop:"id",label:"id"},{prop:"left",label:"left"},{prop:"top",label:"top"},{prop:"width",label:"width"});const L=({action:e,row:a=null})=>{"edit"===e?t("event-emit",{name:"editGroup",props:a}):S(a)},S=async e=>{try{await h.s.confirm("確定要刪除此群組，刪除後將無法回復","警告",{confirmButtonText:"確認",cancelButtonText:"取消",closeOnClickModal:!1,type:"warning"}),await m.A.delete(e.id);const t=r.state.group.groupList,a=t.findIndex(t=>t.id===e.id);r.dispatch("group/deleteGroup",a),(0,f.nk)({type:"success",message:"刪除成功"}),k()}catch{}},_=async()=>{try{await h.s.confirm("確認刪除？","提醒",{confirmButtonText:"確認",cancelButtonText:"取消",closeOnClickModal:!1,type:"warning"});for(const e of C.value)if(e.id){await m.A.delete(e.id);const t=r.state.group.groupList,a=t.findIndex(t=>t.id===e.id);r.dispatch("group/deleteGroup",a)}C.value=[],(0,f.nk)({type:"success",message:"刪除成功"}),k()}catch{return!1}};(0,v.Ry)({columnSetting:x,handleAction:L,actions:["edit","delete"]});const D=(0,u.ref)(!1),E=e=>{const t=/xmlformats/,a=t.test(e.type);if(!a)return(0,f.nk)({message:"僅能上傳Excel檔",type:"error"}),!1;D.value=!0},A=e=>{D.value=!1;const{file:t}=e,n={id:"only",component:()=>Promise.all([a.e(9507),a.e(825)]).then(a.bind(a,83767)),headerTitle:"ip 匯入資料檢查",contentSize:{width:"90%",height:"90%"}},l={file:t,columnSetting:W,addItem:async e=>{const t=[];for(let n=0;n<e.length;n++){const l=e[n],o=(0,b.cloneDeep)(l);o.children=JSON.parse(l.children);const s=i.value.find(e=>e.title===l.title);try{if(s){const e=await m.A.update(o,s.id);r.dispatch("group/updateGroup",e)}else{const e=await m.A.addItem(o);r.dispatch("group/addGroup",e)}}catch(a){const{detail:e}=a.response.data;t.push(e)}}if(0!==t.length)return(0,f.nk)({type:"error",message:"匯入失敗，請檢查匯入內容"}),e.forEach((e,a)=>{const n={};Object.keys(t[a]).forEach(e=>{n[e]=t[a][e].join("/")}),e.errorMessage=n}),e;(0,f.nk)({type:"success",message:"匯入成功"})},sheetUse:[0],unChange:!1},o={"refresh-page":k};r.dispatch("panels/addPanel",{settings:n,props:l,events:o})},B=()=>{t("close")};return(0,n.KC)(()=>{k()}),(0,n.sV)(()=>{setTimeout(()=>{d.value=y.value.offsetHeight-w.value.offsetHeight,c.value=y.value.offsetWidth},100)}),{closePanel:B,columnSetting:x,searchBlock:w,view:y,tableHeight:d,tableWidth:c,getList:k,ordering:o,listLoading:l,tableList:i,totalNumb:s,selected:C,beforeUpload:E,loading:D,downloadColumn:W,downloadData:p,openImportPreviewCheck:A,deleteSelected:_}}},w=(a(56695),a(71241));const y=(0,w.A)(k,[["render",p],["__scopeId","data-v-1596a50f"]]);var C=y}}]);