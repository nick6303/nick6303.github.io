(self["webpackChunkcontrol_center"]=self["webpackChunkcontrol_center"]||[]).push([[2719],{915:function(e,l,t){"use strict";t.r(l);var a=t(31601),o=t.n(a),n=t(76314),r=t.n(n),u=r()(o());u.push([e.id,".panelContent.EditTable .contentWrapper .el-form .el-form-item.apiurl{z-index:99;position:relative}.panelContent.EditTable .contentWrapper .el-form .el-form-item.apiurl .SearchData{width:100%}.panelContent.EditTable .contentWrapper .el-form .row{align-items:center}.panelContent.EditTable .contentWrapper .el-form .row p{margin-left:3px}.panelContent.EditTable .contentWrapper .cell{display:flex;justify-content:center;align-items:center}.panelContent.EditTable .contentWrapper .TableBlock{width:100%;position:relative;height:calc(95vh - 571px)!important;min-height:300px;display:flex;flex-direction:column}.panelContent.EditTable .contentWrapper .TableBlock .table{height:100%;display:flex;flex-direction:column;border-top:1px solid var(--table_border_color);overflow:hidden}.panelContent.EditTable .contentWrapper .TableBlock .el-scrollbar{flex:1}.panelContent.EditTable .contentWrapper .TableBlock .el-scrollbar .el-scrollbar__view{min-height:100%}.panelContent.EditTable .contentWrapper .TableBlock .cell{pointer-events:none}.panelContent.EditTable .contentWrapper .TableBlock .contextMenu{width:285px;background-color:#fff;position:fixed;border-radius:3px;box-shadow:0 0 5px 1px rgba(0,0,0,.1);padding:7px 7px 7px 10px}.panelContent.EditTable .contentWrapper .TableBlock .contextMenu.isUnit{width:500px}.panelContent.EditTable .contentWrapper .TableBlock .contextMenu .el-form-item{margin-bottom:0;align-items:flex-start!important}.panelContent.EditTable .contentWrapper .TableBlock .contextMenu .el-form-item:not(:last-child){margin-bottom:10px}.panelContent.EditTable .contentWrapper .TableBlock .contextMenu .el-form-item .el-form-item__label{width:80px}.panelContent.EditTable .contentWrapper .TableBlock .contextMenu .transform .unit .addUnit{margin:0}",""]),l["default"]=u},9493:function(e,l,t){"use strict";t.r(l);var a=t(31601),o=t.n(a),n=t(76314),r=t.n(n),u=r()(o());u.push([e.id,".ps[data-v-11abfd4b]{font-size:12px;color:red}.el-icon-info[data-v-11abfd4b]{font-size:16px}",""]),l["default"]=u},32726:function(e,l,t){var a=t(915);a.__esModule&&(a=a.default),"string"===typeof a&&(a=[[e.id,a,""]]),a.locals&&(e.exports=a.locals);var o=t(68459).A;o("74e1a212",a,!0,{sourceMap:!1,shadowMode:!1})},92719:function(e,l,t){"use strict";t.r(l),t.d(l,{default:function(){return K}});var a=t(56768);const o={class:"panelContent EditTable"},n={class:"contentWrapper"},r={class:"row"},u={class:"row"},d={class:"row"},i={class:"row"},c={class:"buttonWrapper"};function s(e,l,t,s,m,p){const f=(0,a.g2)("SearchData"),b=(0,a.g2)("el-form-item"),h=(0,a.g2)("el-divider"),g=(0,a.g2)("FontFamily"),v=(0,a.g2)("FontSizeEdit"),C=(0,a.g2)("SelectColumn"),k=(0,a.g2)("el-switch"),w=(0,a.g2)("ColorPicker"),S=(0,a.g2)("el-input"),x=(0,a.g2)("Table"),F=(0,a.g2)("RefreshTime"),y=(0,a.g2)("el-form"),V=(0,a.g2)("el-button"),D=(0,a.gN)("loading");return(0,a.uX)(),(0,a.CE)("div",o,[(0,a.Lk)("div",n,[(0,a.bF)(y,{class:"contentInner",ref:"editForm",model:s.formData,rules:s.rules,"label-width":"110px"},{default:(0,a.k6)(()=>[(0,a.bF)(b,{class:"apiurl",label:"資料來源",prop:"apiurl"},{default:(0,a.k6)(()=>[(0,a.bF)(f,{modelValue:s.formData.apiurl,"onUpdate:modelValue":l[0]||(l[0]=e=>s.formData.apiurl=e),onUpdate:s.updateApiurl},null,8,["modelValue","onUpdate"])]),_:1}),s.tableList.length>0?((0,a.uX)(),(0,a.CE)(a.FK,{key:0},[(0,a.bF)(h,{"content-position":"left"},{default:(0,a.k6)(()=>[...l[13]||(l[13]=[(0,a.Lk)("b",null,"樣式設定",-1)])]),_:1}),(0,a.Lk)("div",r,[(0,a.bF)(b,{label:"字型"},{default:(0,a.k6)(()=>[(0,a.bF)(g,{modelValue:s.formData.fontFamily,"onUpdate:modelValue":l[1]||(l[1]=e=>s.formData.fontFamily=e)},null,8,["modelValue"])]),_:1}),(0,a.bF)(b,{label:"文字大小"},{default:(0,a.k6)(()=>[(0,a.bF)(v,{modelValue:s.formData.fontSize,"onUpdate:modelValue":l[2]||(l[2]=e=>s.formData.fontSize=e)},null,8,["modelValue"])]),_:1})]),(0,a.bF)(b,{label:"顯示欄位"},{default:(0,a.k6)(()=>[(0,a.bF)(C,{modelValue:s.selectColumn,"onUpdate:modelValue":l[3]||(l[3]=e=>s.selectColumn=e),tableList:s.tableList,onUpdate:s.updateSelectColumn},null,8,["modelValue","tableList","onUpdate"])]),_:1}),(0,a.Lk)("div",u,[(0,a.bF)(b,{label:"顯示頁首"},{default:(0,a.k6)(()=>[(0,a.bF)(k,{modelValue:s.formData.showHead,"onUpdate:modelValue":l[4]||(l[4]=e=>s.formData.showHead=e)},null,8,["modelValue"])]),_:1}),s.formData.showHead?((0,a.uX)(),(0,a.CE)(a.FK,{key:0},[(0,a.bF)(b,{label:"頁首背景顏色"},{default:(0,a.k6)(()=>[(0,a.bF)(w,{modelValue:s.formData.headerBgc,"onUpdate:modelValue":l[5]||(l[5]=e=>s.formData.headerBgc=e),showAlpha:""},null,8,["modelValue"])]),_:1}),(0,a.bF)(b,{label:"頁首文字顏色"},{default:(0,a.k6)(()=>[(0,a.bF)(w,{modelValue:s.formData.headerWordColor,"onUpdate:modelValue":l[6]||(l[6]=e=>s.formData.headerWordColor=e),showAlpha:""},null,8,["modelValue"])]),_:1})],64)):(0,a.Q3)("",!0)]),(0,a.Lk)("div",d,[(0,a.bF)(b,{class:"noFlex",label:"內容背景顏色"},{default:(0,a.k6)(()=>[(0,a.Lk)("div",i,[(0,a.bF)(w,{modelValue:s.formData.contentBgc,"onUpdate:modelValue":l[7]||(l[7]=e=>s.formData.contentBgc=e),showAlpha:"",onChange:s.changeContentBgc},null,8,["modelValue","onChange"]),s.formData.contentBgc?((0,a.uX)(),(0,a.CE)(a.FK,{key:0},[l[14]||(l[14]=(0,a.Lk)("p",null,"(單行)",-1)),(0,a.bF)(h,{direction:"vertical"}),(0,a.bF)(w,{modelValue:s.formData.contentBgc2,"onUpdate:modelValue":l[8]||(l[8]=e=>s.formData.contentBgc2=e),showAlpha:""},null,8,["modelValue"]),l[15]||(l[15]=(0,a.Lk)("p",null,"(雙行)",-1))],64)):(0,a.Q3)("",!0)])]),_:1}),(0,a.bF)(b,{class:"noFlex",label:"內容文字顏色"},{default:(0,a.k6)(()=>[(0,a.bF)(w,{modelValue:s.formData.contentWordColor,"onUpdate:modelValue":l[9]||(l[9]=e=>s.formData.contentWordColor=e),showAlpha:""},null,8,["modelValue"])]),_:1}),(0,a.bF)(b,{class:"noFlex",label:"表格高度自適應","label-width":"130px"},{default:(0,a.k6)(()=>[(0,a.bF)(k,{modelValue:s.formData.autoHeight,"onUpdate:modelValue":l[10]||(l[10]=e=>s.formData.autoHeight=e)},null,8,["modelValue"])]),_:1}),(0,a.bF)(b,{class:"noFlex",label:"邊框顏色"},{default:(0,a.k6)(()=>[(0,a.bF)(w,{modelValue:s.formData.borderColor,"onUpdate:modelValue":l[11]||(l[11]=e=>s.formData.borderColor=e),showAlpha:""},null,8,["modelValue"])]),_:1}),(0,a.bF)(b,{label:"邊框圓角"},{default:(0,a.k6)(()=>[(0,a.bF)(S,{modelValue:s.formData.borderRadius,"onUpdate:modelValue":l[12]||(l[12]=e=>s.formData.borderRadius=e)},{append:(0,a.k6)(()=>[...l[16]||(l[16]=[(0,a.eW)("PX",-1)])]),_:1},8,["modelValue"])]),_:1})]),(0,a.bF)(h,{"content-position":"left"},{default:(0,a.k6)(()=>[...l[17]||(l[17]=[(0,a.Lk)("b",null,"預覽",-1)])]),_:1}),(0,a.bo)((0,a.bF)(x,{tableList:s.tableList,formData:s.formData,selectColumn:s.selectColumn,onUpdatecolumnSet:s.updatecolumnSet},null,8,["tableList","formData","selectColumn","onUpdatecolumnSet"]),[[D,s.loading]]),(0,a.bF)(h,{"content-position":"left"},{default:(0,a.k6)(()=>[...l[18]||(l[18]=[(0,a.eW)("更新設定",-1)])]),_:1}),(0,a.bF)(F,{propRefresh:s.refreshApi,onUpdateRefreshApi:s.updateRefreshApi},null,8,["propRefresh","onUpdateRefreshApi"])],64)):(0,a.Q3)("",!0)]),_:1},8,["model","rules"])]),(0,a.Lk)("div",c,[(0,a.bF)(V,{type:"danger",onClick:s.closePanel},{default:(0,a.k6)(()=>[...l[19]||(l[19]=[(0,a.eW)("取消",-1)])]),_:1},8,["onClick"]),(0,a.bF)(V,{type:"success",onClick:s.checkValidate},{default:(0,a.k6)(()=>[...l[20]||(l[20]=[(0,a.Lk)("span",null,"儲存",-1)])]),_:1},8,["onClick"])])])}t(18111),t(20116),t(7588),t(61701);var m=t(90144),p=t(7118),f=t(78626),b=t(51219),h=t(77187),g=t(42497),v=t(7681),C=t(10406),k=t(43988),w=t(24232);const S={class:"TableBlock",ref:"TableBlock"},x={key:0,class:"thead",ref:"thead"},F={class:"tr"},y=["onContextmenu"],V={class:"cell"},D={class:"table"},E=["onContextmenu"],W={class:"cell"};function T(e,l,t,o,n,r){const u=(0,a.g2)("el-scrollbar"),d=(0,a.g2)("el-input"),i=(0,a.g2)("el-form-item"),c=(0,a.g2)("TransformItem"),s=(0,a.g2)("el-form");return(0,a.uX)(),(0,a.CE)("div",S,[(0,a.Lk)("div",{class:"table",style:(0,w.normalizeStyle)({borderLeftColor:t.formData.borderColor,fontSize:t.formData.fontSize,borderTopColor:t.formData.showHead?"":t.formData.borderColor,borderRadius:`${t.formData.borderRadius}px`}),ref:"table",onClick:l[0]||(l[0]=(...e)=>o.closeContextMenu&&o.closeContextMenu(...e))},[t.formData.showHead?((0,a.uX)(),(0,a.CE)("div",x,[(0,a.Lk)("div",F,[((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(o.columnSetting,(e,l)=>((0,a.uX)(),(0,a.CE)("div",{class:"th",key:e.prop,style:(0,w.normalizeStyle)(o.theadStyle(e)),onContextmenu:e=>o.onContextmenu(e,l),title:"點擊滑鼠右鍵編輯"},[(0,a.Lk)("div",V,[(0,a.Lk)("span",{style:(0,w.normalizeStyle)({fontFamily:t.formData.fontFamily})},(0,w.toDisplayString)(e.label),5)])],44,y))),128))])],512)):(0,a.Q3)("",!0),(0,a.bF)(u,{class:"tbody",onScroll:o.tbodyScroll},{default:(0,a.k6)(()=>[(0,a.Lk)("div",D,[((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(t.tableList,(e,l)=>((0,a.uX)(),(0,a.CE)("div",{class:"tr",key:l},[((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(o.columnSetting,(n,r)=>((0,a.uX)(),(0,a.CE)("div",{class:"td",key:n.prop,style:(0,w.normalizeStyle)(o.tdStyle(n,l)),onContextmenu:e=>o.onContextmenu(e,r),title:"點擊滑鼠右鍵編輯"},[(0,a.Lk)("div",W,[(0,a.Lk)("span",{style:(0,w.normalizeStyle)({fontFamily:t.formData.fontFamily})},(0,w.toDisplayString)(n.transform?o.transformValue(e[n.prop],n.transform,!1,n.mathString):e[n.prop]),5)])],44,E))),128))]))),128))])]),_:1},8,["onScroll"])],4),null!==o.currentColumn.index?((0,a.uX)(),(0,a.CE)("div",{class:(0,w.normalizeClass)(["contextMenu",{isUnit:o.checkTransform}]),key:o.currentColumn.left,style:(0,w.normalizeStyle)({top:`calc(${o.currentColumn.top}px - 2.5vh`,left:`calc(${o.currentColumn.left}px - 5vw)`})},[(0,a.bF)(s,{"label-width":"80px"},{default:(0,a.k6)(()=>[(0,a.bF)(i,{label:"標題"},{default:(0,a.k6)(()=>[(0,a.bF)(d,{modelValue:o.currentColumn.label,"onUpdate:modelValue":l[1]||(l[1]=e=>o.currentColumn.label=e),onChange:o.updateColumn},null,8,["modelValue","onChange"])]),_:1}),(0,a.bF)(i,{label:"寬度"},{default:(0,a.k6)(()=>[(0,a.bF)(d,{modelValue:o.currentColumn.width,"onUpdate:modelValue":l[2]||(l[2]=e=>o.currentColumn.width=e),onChange:o.updateColumn},{append:(0,a.k6)(()=>[...l[3]||(l[3]=[(0,a.eW)("PX",-1)])]),_:1},8,["modelValue","onChange"])]),_:1}),(0,a.bF)(c,{transform:o.currentColumn.transform,mathString:o.currentColumn.mathString,onUpdate:o.updateTransform},null,8,["transform","mathString","onUpdate"])]),_:1})],6)):(0,a.Q3)("",!0)],512)}t(22489),t(18237);var _=t(56383),A=t(69481),B={name:"TableDemo",components:{TransformItem:A.A},props:{tableList:Array,formData:Object,selectColumn:Array},setup(e,{emit:l}){const t=(0,m.ref)(null),o=(0,a.EW)(()=>e?e.selectColumn:[]),n=(0,a.EW)(()=>e?e.formData:{}),r=(0,m.ref)([]),u=(0,m.ref)(null),d=(0,m.ref)(0),i=(0,m.ref)(null),c=(0,m.reactive)({left:0,top:0,index:null,label:"",width:0,transform:"",mathString:""}),s=(0,a.EW)(()=>{const e=/unit|format|computed/;return e.test(c.transform)}),p=(0,a.EW)(()=>{const l=n.value.showHead?1:0,t=e?e.tableList:[],a=.9*window.innerHeight-271-10-45-64,o=a/(t.length+l)-1;return o>parseInt(n.value.fontSize)?`${o}px`:n.value.fontSize}),f=()=>{const e=u.value.offsetWidth,l=r.value.reduce((e,l)=>l.width?e+l.width:e,0),t=r.value.filter(e=>!e.width);l>e?d.value=100:(d.value=Math.floor((e-l)/t.length),d.value<100&&(d.value=100))},b=l=>{const t=e?e.formData:{},{columnSet:a}=t;r.value=l.map(e=>{const l=a.find(l=>l.prop===e),t=l?l.label:e,o=l?l.width:0,n=l?l.transform:"",r=l?l.mathString:"";return{prop:e,label:t,width:o,transform:n,mathString:r}}),f()},h=()=>{null!==c.index&&(r.value[c.index].label=c.label,r.value[c.index].width=1*c.width,r.value[c.index].transform=c.transform,r.value[c.index].mathString=c.mathString,l("updatecolumnSet",r.value),f())},g=e=>{const{transform:l,mathString:t}=e;c.transform=l,c.mathString=t;const a=s.value?500:285;c.left>.95*window.innerWidth-a-10&&(c.left=.95*window.innerWidth-a-10),h()},v=async(e,l)=>{e.preventDefault(),c.index=l,c.left=e.pageX,c.top=e.pageY,c.label=r.value[l].label,c.width=r.value[l].width,c.mathString=r.value[l].mathString,c.transform=r.value[l].transform,await(0,a.dY)();const t=s.value?500:285;c.left>.95*window.innerWidth-t-10&&(c.left=.95*window.innerWidth-t-10)},C=()=>{h(),c.index=null},k=e=>e?e+"px":d.value+"px",w=e=>{const{scrollLeft:l}=e;i.value&&i.value.scrollLeft!==l&&l>=0&&i.value.scrollLeft+1!==l&&(i.value.scrollLeft=l)},S=e=>({color:n.value.headerWordColor,backgroundColor:n.value.headerBgc,borderRightColor:n.value.borderColor,borderBottomColor:n.value.borderColor,borderTopColor:n.value.borderColor,height:p.value,width:k(e.width)}),x=(e,l)=>{const t=(l+1)%2===0;return{color:n.value.contentWordColor,backgroundColor:t&&n.value.contentBgc2?n.value.contentBgc2:n.value.contentBgc,borderRightColor:n.value.borderColor,borderBottomColor:n.value.borderColor,height:p.value,width:k(e.width)}};return(0,a.wB)(o,async e=>{await(0,a.dY)(),b(e)},{deep:!0}),{table:t,onContextmenu:v,currentColumn:c,columnSetting:r,updateColumn:h,closeContextMenu:C,getWidth:k,TableBlock:u,tbodyScroll:w,thead:i,columnHeight:p,updateTransform:g,transformValue:_.A,theadStyle:S,tdStyle:x,checkTransform:s}}},L=t(71241);const U=(0,L.A)(B,[["render",T]]);var z=U;function X(e,l,t,o,n,r){const u=(0,a.g2)("el-checkbox"),d=(0,a.g2)("el-option"),i=(0,a.g2)("el-select");return(0,a.uX)(),(0,a.Wv)(i,{modelValue:o.selectColumn,"onUpdate:modelValue":l[1]||(l[1]=e=>o.selectColumn=e),multiple:"","popper-class":"filterColumn",onChange:o.changeSelect},{default:(0,a.k6)(()=>[(0,a.bF)(u,{indeterminate:o.isIndeterminate,modelValue:o.isSelectAll,"onUpdate:modelValue":l[0]||(l[0]=e=>o.isSelectAll=e),size:"small",onChange:o.toggleSelectAll},{default:(0,a.k6)(()=>[...l[2]||(l[2]=[(0,a.eW)("全選",-1)])]),_:1},8,["indeterminate","modelValue","onChange"]),((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(o.filterColumn,e=>((0,a.uX)(),(0,a.Wv)(d,{key:e,value:e,label:e},null,8,["value","label"]))),128))]),_:1},8,["modelValue","onChange"])}var M={name:"SelectColumn",props:{tableList:Array,modelValue:Array},setup(e,{emit:l}){const t=e?e.modelValue:[],o=(0,a.EW)(()=>{const l=e?e.tableList:[];return l.length>0?Object.keys(l[0]):[]}),n=(0,m.ref)(!1),r=(0,m.ref)([]),u=(0,a.EW)(()=>0!==r.value.length&&r.value.length!==o.value.length),d=e=>{n.value=e.length===o.value.length,l("update:modelValue",e),l("update",e)},i=e=>{r.value=e?o.value:[],d(r.value)};return(0,a.wB)(o,()=>{i(!0)},{deep:!0}),(0,a.sV)(()=>{t.length>0?(n.value=t.length===o.value.length,r.value=t):i(!0)}),{isIndeterminate:u,toggleSelectAll:i,changeSelect:d,filterColumn:o,isSelectAll:n,selectColumn:r}}};t(96858);const R=(0,L.A)(M,[["render",X],["__scopeId","data-v-11abfd4b"]]);var H=R,I={name:"EditTable",components:{Table:z,SelectColumn:H,SearchData:k.A,RefreshTime:C.A,FontFamily:g.A},props:{configProps:{type:Object,default:null}},setup(e,{emit:l}){const t=(0,m.ref)(!1),o=(0,m.ref)(null),n=(0,a.EW)(()=>e?e.configProps.info:{}),r=(0,m.ref)([]),u=(0,m.ref)([]),d=(0,m.reactive)({apiurl:"",headerBgc:null,headerWordColor:null,contentBgc:null,contentBgc2:null,contentWordColor:null,borderColor:"",columnSet:[],showHead:!0,fontSize:"",fontFamily:"",autoHeight:!1,borderRadius:""}),i=(0,m.reactive)({isEnabled:!1,time:1}),c=(0,p.Q4)(d),s=()=>{o.value.validate(e=>{e&&g()})},g=async()=>{const e=(0,f.cloneDeep)(n.value);delete e.id,Object.assign(e,{parameter:{...d},refreshApi:i});try{let t,a="資料更新成功";n.value.id?t=await v.A.updatePartOf(e,n.value.id):(t=await v.A.addItem(e),a="資料新增成功"),(0,b.nk)({type:"success",message:a}),l("event-emit",{name:"refresh-page",props:t}),C()}catch{}},C=()=>{l("close")},k=e=>{const l=(0,f.cloneDeep)(d.columnSet);d.columnSet=e.map(e=>{const t=l.find(l=>l.prop===e);return{prop:e,label:t?t.label:e,width:t?t.width:0,transform:t?t.transform:"",mathString:t?t.mathString:""}})},w=async e=>{await S(e),r.value.length>0&&(d.columnSet=Object.keys(r.value[0]).map(e=>({prop:e,label:e,width:0,transform:"",mathString:""})),u.value=Object.keys(r.value[0]))},S=async e=>{if(e){t.value=!0;try{o.value&&o.value.validate();const l=(0,f.cloneDeep)(e);r.value=await h.A.getData(l)}catch{r.value=[],(0,b.nk)({type:"error",message:"取得資料失敗"})}finally{t.value=!1}}},x=()=>{const{parameter:e,refreshApi:l}=n.value;Object.keys(d).forEach(l=>{(e[l]||!1===e[l])&&("columnSet"===l&&(u.value=e.columnSet.map(e=>e.prop)),d[l]=(0,f.cloneDeep)(e[l]))}),i.isEnabled=!!l&&l.isEnabled,i.time=l?l.time:1,S(e.apiurl)},F=e=>{d.columnSet=e},y=e=>{const{isEnabled:l,time:t}=e;i.isEnabled=l,i.time=t},V=e=>{d.contentBgc2||(d.contentBgc2=e)};return(0,a.KC)(()=>{x()}),{closePanel:C,loading:t,editForm:o,rules:c,formData:d,checkValidate:s,getData:S,tableList:r,updatecolumnSet:F,selectColumn:u,refreshApi:i,updateRefreshApi:y,updateApiurl:w,updateSelectColumn:k,changeContentBgc:V}}};t(32726);const j=(0,L.A)(I,[["render",s]]);var K=j},96858:function(e,l,t){var a=t(9493);a.__esModule&&(a=a.default),"string"===typeof a&&(a=[[e.id,a,""]]),a.locals&&(e.exports=a.locals);var o=t(68459).A;o("a08df748",a,!0,{sourceMap:!1,shadowMode:!1})}}]);