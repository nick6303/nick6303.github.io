(self["webpackChunkcontrol_center"]=self["webpackChunkcontrol_center"]||[]).push([[8668],{27144:function(e,l,a){"use strict";a.r(l);var t=a(31601),n=a.n(t),o=a(76314),r=a.n(o),i=r()(n());i.push([e.id,".panelContent[data-v-0929a858] .el-form-item__content{display:flex;align-items:center}.panelContent[data-v-0929a858] .el-form-item__content .row{width:100%}.panelContent[data-v-0929a858] .el-form-item__content .row .src{flex:1}.panelContent[data-v-0929a858] .el-form-item__content .el-button{margin:0 10px 0 0}",""]),l["default"]=i},27193:function(e,l,a){var t=a(27574);t.__esModule&&(t=t.default),"string"===typeof t&&(t=[[e.id,t,""]]),t.locals&&(e.exports=t.locals);var n=a(68459).A;n("4e561572",t,!0,{sourceMap:!1,shadowMode:!1})},27574:function(e,l,a){"use strict";a.r(l);var t=a(31601),n=a.n(t),o=a(76314),r=a.n(o),i=r()(n());i.push([e.id,".SelectPanel .top{display:flex;align-items:flex-start}.SelectPanel .top .back{margin-right:10px!important}.SelectPanel .top .el-scrollbar{height:326px}@media(min-height:800px){.SelectPanel .top .el-scrollbar{height:176px}}.SelectPanel .top .el-scrollbar__view{display:flex;flex-wrap:wrap}.SelectPanel .top .el-scrollbar__view .file>span{flex-direction:column}.SelectPanel .top .el-button,.SelectPanel .top .el-radio{width:190px;height:auto;padding:5px;margin:0}.SelectPanel .top .el-button i,.SelectPanel .top .el-radio i{font-size:100px;font-style:normal;line-height:1.2}.SelectPanel .top .el-button p,.SelectPanel .top .el-radio p{text-overflow:ellipsis;white-space:nowrap;overflow:hidden;display:block}.SelectPanel .top .el-radio__input{display:none}.SelectPanel .top .el-radio__label{padding:5px;display:flex;justify-content:center;align-items:center;flex-direction:column}.SelectPanel .top .el-button{border:none}.SelectPanel .panels{display:flex;height:calc(95vh - 600px)}@media(min-height:800px){.SelectPanel .panels{height:calc(95vh - 450px)}}.SelectPanel .panels .el-divider--vertical{height:100%;margin:0 15px}.SelectPanel .panels .preview{width:50%;height:100%;border:1px solid #dcdfe6;border-radius:5px;position:relative;padding:30px 15px 10px}.SelectPanel .panels .preview b{position:absolute;top:10px;left:15px;font-size:16px}.SelectPanel .panels .preview figure{display:flex;justify-content:center;align-items:center;width:100%;height:100%}.SelectPanel .panels .preview figure img{max-height:100%}.SelectPanel .panels .el-scrollbar{width:50%;height:100%}.SelectPanel .panels .el-scrollbar .el-scrollbar__view{width:100%;display:flex;flex-wrap:wrap}.SelectPanel .panels .el-scrollbar .el-scrollbar__view .el-empty{width:100%}.SelectPanel .panels .el-scrollbar .el-radio{margin:10px 5px;height:40px;display:flex;align-items:center;padding:0 15px 0 10px}.SelectPanel .panels .el-scrollbar .el-radio__label{font-size:14px}",""]),l["default"]=i},61143:function(e,l,a){var t=a(27144);t.__esModule&&(t=t.default),"string"===typeof t&&(t=[[e.id,t,""]]),t.locals&&(e.exports=t.locals);var n=a(68459).A;n("45437e1d",t,!0,{sourceMap:!1,shadowMode:!1})},78668:function(e,l,a){"use strict";a.r(l),a.d(l,{default:function(){return R}});var t=a(56768),n=a(45130);const o={class:"panelContent"},r={class:"contentWrapper"},i={class:"row"},u={class:"buttonWrapper"};function s(e,l,a,s,d,p){const c=(0,t.g2)("el-button"),m=(0,t.g2)("el-input"),f=(0,t.g2)("el-form-item"),b=(0,t.g2)("DataPicker"),v=(0,t.g2)("el-switch"),g=(0,t.g2)("el-option"),k=(0,t.g2)("el-select"),h=(0,t.g2)("el-form"),w=(0,t.g2)("SelectPanel");return(0,t.uX)(),(0,t.CE)("div",o,[(0,t.Lk)("div",r,[(0,t.bF)(h,{class:"contentInner",ref:"editForm",model:s.formData,rules:s.rules,"label-width":"80px"},{default:(0,t.k6)(()=>[(0,t.bF)(f,{label:"網址",prop:"src"},{default:(0,t.k6)(()=>[(0,t.Lk)("div",i,[(0,t.bF)(c,{class:"openGallery",type:"primary",plain:"",onClick:(0,n.D$)(s.toggle,["stop"])},{default:(0,t.k6)(()=>[...l[4]||(l[4]=[(0,t.Lk)("i",{class:"el-icon-menu"},null,-1)])]),_:1},8,["onClick"]),(0,t.bF)(m,{class:"src",modelValue:s.formData.src,"onUpdate:modelValue":l[0]||(l[0]=e=>s.formData.src=e)},null,8,["modelValue"])])]),_:1}),(0,t.bF)(f,{label:"時間"},{default:(0,t.k6)(()=>[(0,t.bF)(b,{modelValue:s.formData.time,"onUpdate:modelValue":l[1]||(l[1]=e=>s.formData.time=e),onUpdatetime:s.updatetime},null,8,["modelValue","onUpdatetime"])]),_:1}),(0,t.bF)(f,{label:"顏色"},{default:(0,t.k6)(()=>[(0,t.bF)(v,{modelValue:s.formData.theme,"onUpdate:modelValue":l[2]||(l[2]=e=>s.formData.theme=e),"active-color":"#181b1f","inactive-color":"#ebebeb","active-value":"dark","inactive-value":"light","active-text":"深色","inactive-text":"淺色"},null,8,["modelValue"])]),_:1}),s.formData.isDashboard?((0,t.uX)(),(0,t.Wv)(f,{key:0,label:"隱藏欄位"},{default:(0,t.k6)(()=>[(0,t.bF)(k,{modelValue:s.formData.kiosk,"onUpdate:modelValue":l[3]||(l[3]=e=>s.formData.kiosk=e),clearable:""},{default:(0,t.k6)(()=>[(0,t.bF)(g,{value:"true",label:"隱蔵左側與上方"}),(0,t.bF)(g,{value:"tv",label:"隱藏左側"})]),_:1},8,["modelValue"])]),_:1})):(0,t.Q3)("",!0)]),_:1},8,["model","rules"])]),(0,t.Lk)("div",u,[(0,t.bF)(c,{type:"danger",onClick:s.closePanel},{default:(0,t.k6)(()=>[...l[5]||(l[5]=[(0,t.eW)("取消",-1)])]),_:1},8,["onClick"]),(0,t.bF)(c,{type:"success",onClick:s.checkValidate},{default:(0,t.k6)(()=>[...l[6]||(l[6]=[(0,t.Lk)("span",null,"儲存",-1)])]),_:1},8,["onClick"])]),(0,t.bF)(w,{ref:"dialogRef",onSubmit:s.submitSrc},null,8,["onSubmit"])])}var d=a(90144),p=a(51219),c=a(78626),m=a(24232);const f={class:"top"},b={class:"panels"},v={class:"preview"},g={key:0},k=["src"];function h(e,l,a,n,o,r){const i=(0,t.g2)("el-button"),u=(0,t.g2)("el-radio"),s=(0,t.g2)("el-scrollbar"),d=(0,t.g2)("el-divider"),p=(0,t.g2)("el-empty"),c=(0,t.g2)("el-dialog"),h=(0,t.gN)("loading");return(0,t.uX)(),(0,t.Wv)(c,{class:"SelectPanel",modelValue:n.dialogVisible,"onUpdate:modelValue":l[4]||(l[4]=e=>n.dialogVisible=e),width:"90%",top:"5vh","append-to-body":""},{footer:(0,t.k6)(()=>[(0,t.bF)(i,{onClick:n.toggle},{default:(0,t.k6)(()=>[...l[10]||(l[10]=[(0,t.eW)("取消 ",-1)])]),_:1},8,["onClick"]),(0,t.bF)(i,{type:"primary",onClick:n.submit,disabled:!n.iframeSrc},{default:(0,t.k6)(()=>[...l[11]||(l[11]=[(0,t.eW)("確定",-1)])]),_:1},8,["onClick","disabled"])]),default:(0,t.k6)(()=>[(0,t.Lk)("div",f,[n.dashboardList?((0,t.uX)(),(0,t.CE)(t.FK,{key:0},[(0,t.bF)(i,{class:"back",title:"回上層",onClick:n.getAllFolder},{default:(0,t.k6)(()=>[...l[5]||(l[5]=[(0,t.Lk)("i",{class:"el-icon-back"},null,-1)])]),_:1},8,["onClick"]),(0,t.bF)(s,{always:""},{default:(0,t.k6)(()=>[((0,t.uX)(!0),(0,t.CE)(t.FK,null,(0,t.pI)(n.dashboardList,e=>((0,t.uX)(),(0,t.Wv)(u,{modelValue:n.dashboard,"onUpdate:modelValue":l[0]||(l[0]=e=>n.dashboard=e),key:e.uid,label:e.uid,onClick:l=>n.getPanels(e)},{default:(0,t.k6)(()=>[l[6]||(l[6]=(0,t.Lk)("i",{class:"el-icon-menu"},null,-1)),(0,t.Lk)("p",null,(0,m.toDisplayString)(e.title),1)]),_:2},1032,["modelValue","label","onClick"]))),128))]),_:1})],64)):((0,t.uX)(),(0,t.Wv)(s,{key:1,always:""},{default:(0,t.k6)(()=>[((0,t.uX)(!0),(0,t.CE)(t.FK,null,(0,t.pI)(n.folderList,e=>((0,t.uX)(),(0,t.Wv)(i,{class:"file",key:e,onClick:l=>n.getDashboards(e)},{default:(0,t.k6)(()=>[l[7]||(l[7]=(0,t.Lk)("i",null,"📁",-1)),(0,t.Lk)("p",null,(0,m.toDisplayString)(e.title),1)]),_:2},1032,["onClick"]))),128))]),_:1}))]),(0,t.bF)(d,{"content-position":"left"},{default:(0,t.k6)(()=>[...l[8]||(l[8]=[(0,t.Lk)("i",{class:"el-icon-bottom"},null,-1),(0,t.eW)("請選擇 Panel",-1)])]),_:1}),(0,t.Lk)("div",b,[(0,t.bF)(s,{always:""},{default:(0,t.k6)(()=>[((0,t.uX)(!0),(0,t.CE)(t.FK,null,(0,t.pI)(n.panelList,(e,a)=>((0,t.uX)(),(0,t.Wv)(u,{key:e,modelValue:n.iframeSrc,"onUpdate:modelValue":l[1]||(l[1]=e=>n.iframeSrc=e),label:e.iframe_url,onChange:l=>n.changePanel(e),border:""},{default:(0,t.k6)(()=>[(0,t.eW)((0,m.toDisplayString)(e.title),1)]),_:2},1032,["modelValue","label","onChange"]))),128)),0===n.panelList.length?((0,t.uX)(),(0,t.Wv)(p,{key:0,description:"暫無資料"})):(0,t.Q3)("",!0)]),_:1}),(0,t.bF)(d,{direction:"vertical"}),(0,t.Lk)("div",v,[l[9]||(l[9]=(0,t.Lk)("b",null,"圖片預覽：",-1)),n.previewImg?(0,t.bo)(((0,t.uX)(),(0,t.CE)("figure",g,[((0,t.uX)(),(0,t.CE)("img",{key:n.previewImg,src:n.previewImg,onLoad:l[2]||(l[2]=e=>n.imgloading=!1),onError:l[3]||(l[3]=e=>n.imgloading=!1)},null,40,k))])),[[h,n.imgloading]]):((0,t.uX)(),(0,t.Wv)(p,{key:1,description:"未選擇 Panel"}))])])]),_:1},8,["modelValue"])}a(18111),a(61701);var w=a(60594),y={name:"SelectPanel",emits:["submit","toggle"],setup(e,{emit:l}){const a=(0,d.ref)(!1),n=(0,d.ref)(!1),o=(0,d.ref)([]),r=(0,d.ref)(null),i=(0,d.ref)([]),u=(0,d.ref)(""),s=(0,d.ref)(!1),p=(0,d.ref)(""),c=(0,d.ref)(""),m=(0,t.EW)(()=>{const e=i.value.findIndex(e=>e.iframe_url===u.value);return e>-1?i.value[e].image_url:""}),f=async()=>{r.value=null,i.value=[];try{const e=await w.A.getAllFolder();o.value=e.result_data}catch{}},b=async e=>{c.value=e.title;const l=await w.A.getDashboards({folderid:e.id});r.value=l.result_data},v=async e=>{u.value=e.url,s.value=!0;const l=await w.A.getPanels({dashboarduid:e.uid});i.value=l.result_data.map(e=>({...e,loading:!0}))},g=()=>{a.value=!a.value,a.value&&f()},k=()=>{l("submit",{src:u.value,isDashboard:s.value,title:c.value}),g()},h=e=>{s.value=!1,n.value=!0,c.value=e.title};return(0,t.sV)(()=>{f()}),{getPanels:v,getDashboards:b,getAllFolder:f,dashboardList:r,folderList:o,panelList:i,iframeSrc:u,toggle:g,submit:k,previewImg:m,dashboard:p,isDashboard:s,title:c,changePanel:h,imgloading:n,dialogVisible:a}}},_=(a(27193),a(71241));const P=(0,_.A)(y,[["render",h]]);var x=P;const F={class:"timepicker"};function S(e,l,a,o,r,i){const u=(0,t.g2)("el-button"),s=(0,t.g2)("el-radio-button"),d=(0,t.g2)("el-radio-group"),p=(0,t.g2)("el-tab-pane"),c=(0,t.g2)("el-input"),f=(0,t.g2)("el-form-item"),b=(0,t.g2)("el-option"),v=(0,t.g2)("el-select"),g=(0,t.g2)("el-form"),k=(0,t.g2)("el-date-picker"),h=(0,t.g2)("el-tabs"),w=(0,t.g2)("el-popover");return(0,t.uX)(),(0,t.CE)("div",F,[(0,t.bF)(w,{placement:"bottom",width:450,trigger:"click","popper-class":"timePopover"},{reference:(0,t.k6)(()=>[(0,t.bF)(u,{class:"title",type:"info"},{default:(0,t.k6)(()=>[l[6]||(l[6]=(0,t.Lk)("i",{class:"el-icon-date"},null,-1)),(0,t.Lk)("span",null,(0,m.toDisplayString)(o.title),1)]),_:1})]),default:(0,t.k6)(()=>[(0,t.bF)(h,{modelValue:o.activeName,"onUpdate:modelValue":l[5]||(l[5]=e=>o.activeName=e),type:"card"},{default:(0,t.k6)(()=>[(0,t.bF)(p,{class:"preset",label:"預設",name:"1"},{default:(0,t.k6)(()=>[(0,t.bF)(d,{modelValue:o.preset,"onUpdate:modelValue":l[0]||(l[0]=e=>o.preset=e),onChange:o.clickPreset},{default:(0,t.k6)(()=>[((0,t.uX)(!0),(0,t.CE)(t.FK,null,(0,t.pI)(o.presetList,(e,l)=>((0,t.uX)(),(0,t.Wv)(s,{key:e.label,label:l},{default:(0,t.k6)(()=>[(0,t.eW)((0,m.toDisplayString)(e.label),1)]),_:2},1032,["label"]))),128))]),_:1},8,["modelValue","onChange"])]),_:1}),(0,t.bF)(p,{class:"relative",label:"相對",name:"2"},{default:(0,t.k6)(()=>[(0,t.bF)(g,{ref:"relativeRef",inline:!0,"label-position":"top",model:o.relative},{default:(0,t.k6)(()=>[(0,t.bF)(f,{prop:"num",rules:[{required:!0,message:"數值不能為空"},{type:"number",message:"必須為數字"}]},{default:(0,t.k6)(()=>[(0,t.bF)(c,{modelValue:o.relative.num,"onUpdate:modelValue":l[1]||(l[1]=e=>o.relative.num=e),modelModifiers:{number:!0},placeholder:"幾"},null,8,["modelValue"])]),_:1}),(0,t.bF)(f,{class:"dropdown",prop:"unit",rules:[{required:!0,message:"單位不能為空"}]},{default:(0,t.k6)(()=>[(0,t.bF)(v,{modelValue:o.relative.unit,"onUpdate:modelValue":l[3]||(l[3]=e=>o.relative.unit=e),teleported:!1,placeholder:"天"},{default:(0,t.k6)(()=>[((0,t.uX)(!0),(0,t.CE)(t.FK,null,(0,t.pI)(o.relativeList,e=>((0,t.uX)(),(0,t.Wv)(b,{key:e.value,value:e.value,label:e.label,onClick:l[2]||(l[2]=(0,n.D$)(()=>{},["prevent"]))},null,8,["value","label"]))),128))]),_:1},8,["modelValue"]),l[7]||(l[7]=(0,t.Lk)("p",null,"前",-1))]),_:1}),(0,t.bF)(u,{type:"primary",onClick:o.updateRelative},{default:(0,t.k6)(()=>[...l[8]||(l[8]=[(0,t.eW)("確認",-1)])]),_:1},8,["onClick"])]),_:1},8,["model"])]),_:1}),(0,t.bF)(p,{class:"datepicker",label:"選取時間",name:"3"},{default:(0,t.k6)(()=>[(0,t.bF)(k,{modelValue:o.datePicker,"onUpdate:modelValue":l[4]||(l[4]=e=>o.datePicker=e),type:"datetimerange",placeholder:"選擇日期時間","range-separator":"至","start-placeholder":"開始日期","end-placeholder":"結束日期",teleported:!1,onChange:o.changeDate},null,8,["modelValue","onChange"])]),_:1})]),_:1},8,["modelValue"])]),_:1})])}a(20116);var V=a(49148),C=a.n(V);const D=C()(),L=C()().subtract(1,"day").format("YYYY-MM-DD"),O=(D.valueOf(),C()(D.format("YYYY-MM-DD")).valueOf(),C()().startOf("week").valueOf(),C()().startOf("isoweek").valueOf(),C()().startOf("month").valueOf(),C()().startOf("year").valueOf(),C()(L).valueOf(),C()().startOf("week").subtract(7,"day").valueOf(),C()().startOf("week").subtract(1,"day").valueOf(),C()().startOf("isoweek").subtract(7,"day").valueOf(),C()().startOf("month").subtract(1,"month").valueOf(),C()().startOf("year").subtract(1,"year").valueOf(),[{label:"今天",prop:["@d","now"]},{label:"前 15 分鐘",prop:["-15m","now"]},{label:"星期日至今",prop:["w0@d","now"]},{label:"前 60 分鐘",prop:["-60m","now"]},{label:"星期一至今",prop:["w1@d","now"]},{label:"前 4 小時",prop:["-4h","now"]},{label:"本月至今",prop:["@mon","now"]},{label:"前 24 小時",prop:["-24h","now"]},{label:"今年至今",prop:["@y","now"]},{label:"最近 7 天",prop:["-7d","now"]},{label:"昨天",prop:["-1d@d","@d"]},{label:"最近 30 天",prop:["-30d","now"]},{label:"上週",prop:["-w@w0","w0@d"]},{label:"所有時間",prop:["","now"]},{label:"上個工作週",prop:["-6d@w1","-w@w6"]},{label:"上個月",prop:["-1mon@mon","@mon"]},{label:"去年",prop:["-1y@y","@y"]}]),W=[{value:"s",label:"秒"},{value:"m",label:"分"},{value:"h",label:"時"},{value:"d",label:"天"},{value:"w",label:"週"},{value:"mon",label:"月"},{value:"q",label:"季"},{value:"y",label:"年"}];var X=a(7118),A=(a(16431),{name:"TimePicker",props:{modelValue:{type:Array,default:null}},setup(e,{emit:l}){const a=e?e.modelValue:null,n=(0,d.ref)("1"),o=(0,d.ref)("選擇時間"),r=(0,d.ref)(null),i=()=>{const e=O[r.value].prop;o.value=O[r.value].label,l("updatetime",e)},u=(0,d.ref)(null),s=(0,d.reactive)({num:null,unit:null}),p=()=>{u.value.validate(e=>{if(e){l("updatetime",[`-${s.num}${s.unit}`,"now"]);const e=W.find(e=>e.value===s.unit).label;o.value=s.num+e+"前"}})},c=(0,d.ref)(null),m=e=>C()(e).format("YYYY/MM/DD HH:mm"),f=()=>{const e=c.value?c.value:[null,null],a=c.value?c.value.map(e=>m(e)):[null,null];l("updatetime",[...e]),o.value=a[0]+" 至 "+a[1]},b=(0,d.ref)(null),v=(0,d.reactive)({earliest:"",latest:""}),g=()=>{b.value.validate(e=>{e&&(l("updatetime",[v.earliest,v.latest]),o.value="進階輸入")})};return(0,t.sV)(()=>{if(a){const e=O.findIndex(e=>e.prop[0]===a[0]&&e.prop[1]===a[1]);if(e>-1)r.value=`${e}`,o.value=O[e].label;else if(0===a[0].indexOf("-")&&"now"===a[1]){n.value="2",s.num=1*a[0].replaceAll(/-|[A-Za-z]/g,""),s.unit=a[0].replaceAll(/-|[0-9]/g,"");const e=W.find(e=>e.value===s.unit).label;o.value=s.num+e+"前"}else n.value="3",c.value=a,o.value=m(c.value[0])+" 至 "+m(c.value[1])}}),{title:o,activeName:n,preset:r,presetList:O,clickPreset:i,relativeRef:u,relativeList:W,relative:s,updateRelative:p,datePicker:c,changeDate:f,advanceRef:b,advance:v,chageAdvance:g,checkNoSpace:X.wy}}});const E=(0,_.A)(A,[["render",S]]);var I=E,U=a(71886),M={name:"EditGrafana",components:{SelectPanel:x,DataPicker:I},props:{configProps:{type:Object,default:null}},setup(e,{emit:l}){const{info:a}=e.configProps??{},t=(0,d.ref)(null),n=(0,d.ref)(null),o=(0,d.ref)(a.title),r=(0,d.reactive)({src:a.parameter.src,time:a.parameter.time,theme:a.parameter.theme,kiosk:a.parameter.kiosk,isDashboard:a.parameter.isDashboard}),i=(0,X.Q4)(r),u=()=>{t.value.toggle()},s=()=>{n.value.validate(e=>{e&&m()})},m=async()=>{if(!r.src)return void(0,p.nk)({type:"error",message:"請先選擇"});const e=(0,c.cloneDeep)(a);e.title=o.value?o.value:"Grafana_Panel",Object.assign(e,{parameter:r,refreshApi:{time:0,isEnabled:!1}});try{let a,t="資料更新成功";e.id?a=await U.A.updatePartOf(e,e.id):(r.isDashboard&&(e.width="100%",e.height="100%",e.top="0%",e.left="0%"),a=await U.A.addItem(e),t="資料新增成功"),(0,p.nk)({type:"success",message:t}),l("event-emit",{name:"refresh-page",props:a}),b()}catch{}},f=e=>{const{src:l,isDashboard:a,title:t}=e;o.value=t,r.src=l,r.isDashboard=a,a||(r.kiosk="")},b=()=>{l("close")},v=e=>{r.time=e};return{closePanel:b,checkValidate:s,formData:r,dialogRef:t,toggle:u,submitSrc:f,rules:i,updatetime:v,editForm:n}}};a(61143);const Y=(0,_.A)(M,[["render",s],["__scopeId","data-v-0929a858"]]);var R=Y}}]);