(self["webpackChunkcontrol_center"]=self["webpackChunkcontrol_center"]||[]).push([[2796],{30736:function(e,t,n){"use strict";n.d(t,{Bb:function(){return m},Zj:function(){return p},oM:function(){return c}});n(44114),n(18111),n(22489),n(20116);var a=n(39325),o=n(52125),r=n.n(o),s=n(56768),l=n(55129);const i=async(e,t)=>{const n="prev"===t?"currentPageImage2":"currentPageImage",o="prev"===t?"cgBodyToRight":"cgBodyToLeft",s=document.getElementById("app"),l=s.querySelectorAll("iframe");for(let a=0;a<l.length;a++)try{const e=l[a].contentWindow.document.getElementById("app");if(e){const t=await r()(e),n=t.toDataURL("image/jpeg",1),o=l[a].parentNode;o.classList.add("fakeIframe");const s=document.createElement("img");s.src=n,o.append(s)}}catch{}const i=await r()(s);i.classList.add(n),document.body.appendChild(i),a.Ay.push(e),document.getElementsByTagName("html")[0].classList.add("cgHtmlZoom"),document.body.classList.add(o),setTimeout(()=>{document.body.classList.remove(o),document.getElementsByTagName("html")[0].classList.remove("cgHtmlZoom"),i.remove()},2400)},u={CG_A:e=>{i(e,"prev")},CG_B:e=>{i(e,"next")}},c=(0,s.EW)(()=>{const e=l.A.state.user.front_permissions,t=l.A.state.menu.frontMenuList.filter(t=>{const{open_type:n,menu_type:a,carousel:o}=t,r=e.find(e=>e.menu.id===t.id);return 1===n&&2===a&&r.is_visible&&o});return t}),d=(0,s.EW)(()=>{const e=a.Ay.currentRoute.value.path;return c.value.findIndex(t=>t.path===e)}),m=async()=>{const e=d.value>-1?d.value:1,t=c.value.slice(0,e);let n=t[t.length-1];0===d.value&&(n=c.value[c.value.length-1]),await u.CG_A({path:n.path})},p=async()=>{const e=d.value>-1?d.value:c.value.length-1;let t=c.value[e+1];e===c.value.length-1&&(t=c.value[0]),await u.CG_B({path:t.path})}},42796:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return z}});var a=n(56768),o=n(24232);function r(e,t,n,r,s,l){const i=(0,a.g2)("Header"),u=(0,a.g2)("router-view");return(0,a.uX)(),(0,a.CE)("div",{id:"Dashboard",class:(0,o.normalizeClass)({isIframe:r.isIframe})},[r.isIframe?(0,a.Q3)("",!0):((0,a.uX)(),(0,a.Wv)(i,{key:0})),(0,a.Lk)("main",null,[(0,a.bF)(u)])],2)}var s=n(51219),l=n(4249),i=n(84275),u=n(39325);function c(e,t,n,r,s,l){const i=(0,a.g2)("Timer"),u=(0,a.g2)("el-button"),c=(0,a.g2)("el-popover"),d=(0,a.g2)("Menu");return(0,a.uX)(),(0,a.CE)("header",{id:"Header",class:(0,o.normalizeClass)({animation:r.firstEnter})},[(0,a.bF)(i),(0,a.Lk)("div",{class:"title",style:(0,o.normalizeStyle)({height:`${r.themeColor.frontStage_title_height}px`,width:`${r.themeColor.frontStage_title_width}px`,fontSize:`${r.themeColor.frontStage_title_fontSize}px`})},(0,o.toDisplayString)(r.routeTitle),5),(0,a.bF)(c,{placement:"bottom-end",trigger:"hover","popper-class":"userInfo front",offset:5},{reference:(0,a.k6)(()=>[(0,a.bF)(u,{class:"avatar"},{default:(0,a.k6)(()=>[t[0]||(t[0]=(0,a.Lk)("i",{class:"el-icon-user-solid"},null,-1)),(0,a.Lk)("p",null,(0,o.toDisplayString)(r.display_name),1)]),_:1})]),default:(0,a.k6)(()=>[r.allowEditDashboard?((0,a.uX)(),(0,a.Wv)(u,{key:0,onClick:r.toggleEdit},{default:(0,a.k6)(()=>[t[1]||(t[1]=(0,a.Lk)("i",{class:"el-icon-edit"},null,-1)),(0,a.Lk)("span",null,(0,o.toDisplayString)(r.editting?"關閉編輯":"開啟編輯"),1)]),_:1},8,["onClick"])):(0,a.Q3)("",!0),r.swipeMenuList.length>0?((0,a.uX)(),(0,a.Wv)(u,{key:1,onClick:r.toggleSwipe},{default:(0,a.k6)(()=>[t[2]||(t[2]=(0,a.Lk)("i",{class:"el-icon-video-camera-solid"},null,-1)),(0,a.Lk)("span",null,(0,o.toDisplayString)(r.swiping?"關閉輪播":"開始輪播"),1)]),_:1},8,["onClick"])):(0,a.Q3)("",!0),(0,a.bF)(u,{onClick:r.logout},{default:(0,a.k6)(()=>[...t[3]||(t[3]=[(0,a.Lk)("i",{class:"el-icon-lock"},null,-1),(0,a.Lk)("span",null,"Logout",-1)])]),_:1},8,["onClick"])]),_:1}),(0,a.bF)(d)],2)}n(18111),n(22489),n(20116);var d=n(90144);const m={class:"menu",ref:"menuRef"};function p(e,t,n,r,s,l){const i=(0,a.g2)("Node"),u=(0,a.g2)("el-popover");return(0,a.uX)(),(0,a.CE)("div",m,[(0,a.bF)(u,{placement:"bottom-end",trigger:"click","popper-class":"dashBoardMenu",width:"auto"},{reference:(0,a.k6)(()=>[...t[0]||(t[0]=[(0,a.Lk)("button",null,[(0,a.Lk)("span")],-1)])]),default:(0,a.k6)(()=>[(0,a.Lk)("ul",{class:(0,o.normalizeClass)(["menuBox main","left"===r.menuPosi?"left":"right"])},[((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(r.menuList,e=>((0,a.uX)(),(0,a.Wv)(i,{key:e.id,nodeData:e},{default:(0,a.k6)(()=>[((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(e.children,e=>((0,a.uX)(),(0,a.Wv)(i,{key:e.id,nodeData:e},{default:(0,a.k6)(()=>[((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(e.children,e=>((0,a.uX)(),(0,a.Wv)(i,{key:e.id,nodeData:e},{default:(0,a.k6)(()=>[((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(e.children,e=>((0,a.uX)(),(0,a.Wv)(i,{key:e.id,nodeData:e},null,8,["nodeData"]))),128))]),_:2},1032,["nodeData"]))),128))]),_:2},1032,["nodeData"]))),128))]),_:2},1032,["nodeData"]))),128))],2)]),_:1})],512)}n(44114);const f={class:"menuBox"};function h(e,t,n,r,s,l){return(0,a.uX)(),(0,a.CE)("li",{class:(0,o.normalizeClass)(["menuItem",r.checkPage])},[1===n.nodeData.menu_type&&n.nodeData.is_visible?((0,a.uX)(),(0,a.CE)(a.FK,{key:0},[(0,a.Lk)("p",null,(0,o.toDisplayString)(n.nodeData.title),1),(0,a.Lk)("ul",f,[(0,a.RG)(e.$slots,"default")])],64)):n.nodeData.is_visible?((0,a.uX)(),(0,a.CE)("a",{key:1,onClick:t[0]||(t[0]=(...e)=>r.linkClick&&r.linkClick(...e))},(0,o.toDisplayString)(n.nodeData.title),1)):(0,a.Q3)("",!0)],2)}var g=n(5283),v={name:"FrontMenuNode",props:{nodeData:{type:Object,defult:null}},setup(e){const t=e?e.nodeData:{},n=(0,l.Pj)(),o=(0,a.EW)(()=>n.state.dashboard.frameworkcount),r=(0,a.EW)(()=>{const e=u.Ay.currentRoute.value.name;return t.menuCode===e?"active":""}),i=e=>{const t=/http:|https:/;return t.test(e)},c=e=>{if(!e)return"javascript:void(0)";const t=location.origin,n=e.indexOf("http")>-1?"":`${t}`;return`${n}${e}?showMenu=true`},d=()=>{if(o.value>0)(0,s.nk)({type:"error",message:"尚有Framework未儲存"});else switch(t.open_type){case 1:u.Ay.push({path:t.path});break;case 2:i(t.path)?window.open(t.path):g.A.CG_A(c(t.path));break;case 3:u.Ay.push({path:"/dashboard/iframe"});break;default:break}};return{checkPage:r,linkClick:d,checkPath:i}}},k=n(71241);const y=(0,k.A)(v,[["render",h]]);var _=y,b={name:"DashboardMenu",components:{Node:_},setup(){const e=(0,l.Pj)(),t=(0,a.EW)(()=>{const t=e.state.menu.frontMenuList,n=e.state.user.front_permissions;let a,o,r={},s=[];for(o=0;o<t.length;o++){r[t[o].id]=o,t[o].children=[];const e=n.find(e=>e.menu.id===t[o].id);t[o].is_visible=!!e&&e.is_visible}for(o=0;o<t.length;o++)a=t[o],0!==a.parent_id&&t[r[a.parent_id]]?t[r[a.parent_id]].children.push(a):s.push(a);return s}),n=localStorage.getItem("showMenu"),o=(0,d.ref)(null),r=(0,d.ref)("left"),s=e=>{const t=u.Ay.currentRoute.value.matched;return t.findIndex(t=>t.name===e)>-1},i=()=>{const e=!0,t="/",n=e?location.origin+t:"http://localhost:8086/";document.body.style="animation: fadeOut .7s both",setTimeout(()=>{window.location.href=n},700)};return(0,a.sV)(()=>{}),{checkPage:s,backToMenu:i,showMenu:n,menuRef:o,menuPosi:r,menuList:t}}};const E=(0,k.A)(b,[["render",p]]);var w=E;const C={class:"time"};function L(e,t,n,r,s,l){return(0,a.uX)(),(0,a.CE)("div",C,[t[0]||(t[0]=(0,a.Lk)("i",{class:"el-icon-date"},null,-1)),(0,a.Lk)("p",null,(0,o.toDisplayString)(r.time),1)])}var D=n(49148),I=n.n(D),A={name:"TimerItem",setup(){const e=(0,l.Pj)(),t=(0,a.EW)(()=>e.state.app.themeColor.frontStage_time_format),n=(0,d.ref)(I()().format(t.value));let o;return(0,a.sV)(()=>{o=setInterval(()=>{n.value=I()().format(t.value)},1e3)}),(0,a.xo)(()=>{clearInterval(o)}),{time:n}}};const W=(0,k.A)(A,[["render",L]]);var S=W,M=n(30736),X=n(85265),T={name:"frontEndHeader",components:{Menu:w,Timer:S},setup(){const e=(0,a.EW)(()=>{const e=navigator.userAgent,t=e.indexOf("Android")>-1||e.indexOf("Adr")>-1,n=!!e.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/),a=t||n;return a.value?window.innerWidth-10:340}),t=(0,l.Pj)(),n=(0,a.EW)(()=>t.state.dashboard.frameworkcount),o=(0,a.EW)(()=>t.state.dashboard.editting),r=(0,a.EW)(()=>t.state.app.themeColor),i=(0,a.EW)(()=>t.state.user.user),{display_name:c}=i.value,{allowEditDashboard:m}=t.state.user,p=(0,a.EW)(()=>u.Ay.currentRoute.value.meta.title),f=(0,a.EW)(()=>u.Ay.currentRoute.value.meta.interval),h=(0,d.ref)(!1),g=(0,d.ref)(!1),v=(0,a.EW)(()=>{const e=t.state.user.front_permissions,n=t.state.menu.frontMenuList,a=n.filter(t=>{const{open_type:n,menu_type:a,carousel:o}=t,r=e.find(e=>e.menu.id===t.id);return 1===n&&2===a&&r.is_visible&&o});return a}),k=()=>{n.value>0?(0,s.nk)({type:"error",message:"尚有Framework未儲存"}):(t.dispatch("dashboard/setEditting",!o.value),o.value&&t.dispatch("group/getGroupList"))};let y;const _=()=>{y&&(clearTimeout(y),y=null),h.value&&(y=setTimeout(async()=>{await(0,M.Zj)(),_()},f.value))},b=()=>{h.value=!h.value,_()};return(0,a.xo)(()=>{clearTimeout(y),y=null,t.dispatch("dashboard/setEditting",!1)}),(0,a.sV)(()=>{g.value=!0,setTimeout(()=>{g.value=!1},1500)}),{editting:o,themeColor:r,logout:X.ri,display_name:c,routeTitle:p,toggleEdit:k,toggleSwipe:b,swiping:h,allowEditDashboard:m,firstEnter:g,swipeMenuList:v,popWidth:e}}};n(62635);const x=(0,k.A)(T,[["render",c],["__scopeId","data-v-133f6ace"]]);var F=x,P=F,B=(n(67261),{name:"DashboardPage",components:{Header:P,ElMessage:s.nk},setup(){const e=(0,l.Pj)(),t=(0,a.EW)(()=>u.Ay.currentRoute.value.query.is_iframe),n=(0,a.EW)(()=>e.state.dashboard.editting),o=async()=>{if(!n.value)try{const e=await i.A.autoRefresh();e.access_token&&localStorage.setItem("access_token",e.access_token)}catch{}};return(0,a.sV)(()=>{window.refreshTokenInterval=setInterval(o,54e5);const e=document.querySelector("#endbg");e&&(document.body.style.opacity=1,e.remove())}),(0,a.xo)(()=>{clearInterval(window.refreshTokenInterval)}),{editting:n,isIframe:t}}});const R=(0,k.A)(B,[["render",r]]);var j=R,z=j},62635:function(e,t,n){var a=n(77416);a.__esModule&&(a=a.default),"string"===typeof a&&(a=[[e.id,a,""]]),a.locals&&(e.exports=a.locals);var o=n(68459).A;o("761a2cce",a,!0,{sourceMap:!1,shadowMode:!1})},77416:function(e,t,n){"use strict";n.r(t);var a=n(31601),o=n.n(a),r=n(76314),s=n.n(r),l=s()(o());l.push([e.id,"img[data-v-133f6ace]{width:30%;margin-left:30%}",""]),t["default"]=l}}]);