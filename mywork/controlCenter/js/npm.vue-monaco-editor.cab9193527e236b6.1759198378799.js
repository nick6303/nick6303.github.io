(self["webpackChunkcontrol_center"]=self["webpackChunkcontrol_center"]||[]).push([[8750],{2798:function(e,t,n){"use strict";n.r(t);var a=n(31601),o=n.n(a),i=n(76314),l=n.n(i),r=l()(o());r.push([e.id,".CustomEditor{width:100%;display:flex;flex-direction:column}.CustomEditor .function-btn{margin-bottom:10px}.CustomEditor .function-btn .icon{width:20px;margin-left:5px}.CustomEditor .function-btn .icon-clear_all{font-size:20px}.CustomEditor .editor-block{width:100%;flex:1;border:1.5px solid #dcdfe6;border-radius:3px}.CustomEditor .editor-block .monaco-editor{border-radius:3px}",""]),t["default"]=r},3469:function(e,t,n){var a=n(2798);a.__esModule&&(a=a.default),"string"===typeof a&&(a=[[e.id,a,""]]),a.locals&&(e.exports=a.locals);var o=n(68459).A;o("1cc43ddf",a,!0,{sourceMap:!1,shadowMode:!1})},6656:function(e,t,n){"use strict";var a=n(81202),o=n(85265);t.A={getName(){return(0,a.A)({url:"/prometheusApi/api/v1/label/__name__/values",method:"get"})},getLable(e){const t=e?`?${(0,o.xZ)(e)}`:"";return(0,a.A)({url:`/prometheusApi/api/v1/series${t}`,method:"get"})}}},19460:function(e,t,n){"use strict";var a=n(6656);const o="GET_NAME_LIST",i="SET_NAME_LOADED";t.A={namespaced:!0,state:{nameList:[],nameLoaded:!1},mutations:{[o](e,t){e.nameList=t},[i](e){e.nameLoaded=!0}},actions:{async getNameList(e){if(!e.state.nameLoaded)try{const t=await a.A.getName();e.commit(o,t.data)}catch{}finally{e.commit(i)}}}}},63704:function(e,t,n){"use strict";n.d(t,{Ay:function(){return J}});var a=n(14089),o=(n(18111),n(20116),n(56768)),i=n(90144);const l={wrapper:{display:"flex",position:"relative",textAlign:"initial"},fullWidth:{width:"100%"},hide:{display:"none"}};function r(e,t){const n=(0,o.EW)(()=>{const{width:t,height:n}=e;return{...l.wrapper,width:t,height:n}}),a=(0,o.EW)(()=>({...l.fullWidth,...!t.value&&l.hide}));return{wrapperStyle:n,containerStyle:a}}function u(){const e=(0,i.shallowRef)(a.A.__getMonacoInstance()),t=(0,i.ref)(!1);let n;const l="/mywork/controlCenter/";(0,o.sV)(()=>{e.value||(a.A.config({paths:{vs:`${l}monaco-editor/min/vs`}}),n=a.A.init(),n.then(t=>{e.value=t}).catch(e=>{"cancelation"!==e.type&&(t.value=!0,console.error("Monaco initialization error:",e))}))});const r=()=>!!n&&n.cancel();return{monacoRef:e,unload:r,isLoadFailed:t}}function s(e){return"function"==typeof e?e():e}function d(e){return void 0===e}function c(e,t,n,a){return m(e,a)||p(e,t,n,a)}function m(e,t){return!!e&&e.editor.getModel(g(e,t))}function p(e,t,n,a){return!!e&&e.editor.createModel(t,n,a?g(e,a):void 0)}function g(e,t){return e.Uri.parse(t)}const f={display:"flex",height:"100%",width:"100%",justifyContent:"center",alignItems:"center"};var v=(0,o.pM)({name:"VueMonacoEditor",props:{modelValue:String,defaultValue:String,defaultPath:String,defaultLanguage:String,value:String,language:String,path:String,theme:{type:String,default:"vs"},line:Number,options:{type:Object,default:()=>({})},overrideServices:{type:Object,default:()=>({})},saveViewState:{type:Boolean,default:!0},width:{type:[Number,String],default:"100%"},height:{type:[Number,String],default:"100%"},className:String},emits:["update:modelValue","beforeMount","mount","update","validate"],setup(e,t){const n=new Map,a=(0,i.shallowRef)(null),{monacoRef:l,unload:s,isLoadFailed:m}=u(),{editorRef:p}=h(t,e,l,a),{disposeValidator:g}=y(t,e,l,p),f=(0,o.EW)(()=>!!l.value&&!!p.value),{wrapperStyle:v,containerStyle:_}=r(e,f);return(0,o.hi)(()=>{if(g.value&&g.value(),p.value){const e=p.value.getModel();e&&e.dispose(),p.value.dispose()}else s()}),(0,o.wB)([()=>e.path,()=>e.modelValue,()=>e.language,()=>e.line],([t,a,o,i],[r,u,s,m])=>{if(!f.value)return u;if(t!==r){const u=c(l.value,a||e.defaultValue||"",o||e.defaultLanguage||"",t||e.defaultPath||"");return p.value&&u&&(e.saveViewState&&n.set(r,p.value.saveViewState()),p.value.setModel(u),e.saveViewState&&p.value.restoreViewState(n.get(t))),void(!d(i)&&p.value&&p.value.revealLine(i))}a&&p.value&&p.value.getValue()!==a&&p.value.setValue(a),l.value&&p.value&&o&&o!==s&&l.value.editor.setModelLanguage(p.value.getModel(),o),p.value&&i&&!d(i)&&i!==m&&p.value.revealLine(i)}),(0,o.wB)(()=>e.options,e=>p.value&&p.value.updateOptions(e),{deep:!0}),(0,o.wB)(()=>e.theme,e=>l.value&&l.value.editor.setTheme(e)),{containerRef:a,isEditorReady:f,isLoadFailed:m,wrapperStyle:v,containerStyle:_}},render(){const{$slots:e,isEditorReady:t,isLoadFailed:n,wrapperStyle:a,containerStyle:i,className:l}=this;return(0,o.h)("div",{style:a},[!t&&(0,o.h)("div",{style:f},n?e.failure?s(e.failure):"load failed":e.default?s(e.default):"loading..."),(0,o.h)("div",{ref:"containerRef",key:"monaco_editor_container",style:i,class:l})])}});function h({emit:e},t,n,a){const l=(0,i.shallowRef)(null);function r(){if(!a.value||!n.value||l.value)return;e("beforeMount",n.value);const o=t.path||t.defaultPath,i=c(n.value,t.modelValue||t.defaultValue||"",t.language||t.defaultLanguage||"",o||"");l.value=n.value.editor.create(a.value,{model:i,theme:t.theme,automaticLayout:!0,autoIndent:"brackets",formatOnPaste:!0,formatOnType:!0,...t.options},t.overrideServices),l.value&&l.value.onDidChangeModelContent(n=>{const a=l.value.getValue();a!==t.modelValue&&(e("update:modelValue",a),e("update",a,n))}),l.value&&!d(t.line)&&l.value.revealLine(t.line),e("mount",l.value,n.value)}return(0,o.sV)(()=>{const e=(0,o.wB)(n,()=>{a.value&&n.value&&((0,o.dY)(()=>e()),r())},{immediate:!0})}),{editorRef:l}}function y({emit:e},t,n,a){const l=(0,i.ref)(null),r=(0,o.wB)([n,a],()=>{if(n.value&&a.value){(0,o.dY)(()=>r());const t=n.value.editor.onDidChangeMarkers(t=>{const o=!(!a.value||!a.value.getModel)&&a.value.getModel().uri;if(o){const a=t.find(e=>e.path===o.path);if(a){const t=n.value.editor.getModelMarkers({resource:o});e("validate",t)}}});l.value=()=>t?t.dispose():void 0}});return{disposeValidator:l}}const _={display:"flex",height:"100%",width:"100%",justifyContent:"center",alignItems:"center"};var b=(0,o.pM)({name:"VueMonacoDiffEditor",props:{original:String,modified:String,language:String,originalLanguage:String,modifiedLanguage:String,originalModelPath:String,modifiedModelPath:String,theme:{type:String,default:"vs"},options:{type:Object,default:()=>({})},width:{type:[Number,String],default:"100%"},height:{type:[Number,String],default:"100%"},className:String},setup(e,t){const n=(0,i.shallowRef)(null),{monacoRef:a,unload:l,isLoadFailed:s}=u(),{diffEditorRef:d}=w(t,e,a,n),m=(0,o.EW)(()=>!!a.value&&!!d.value),{wrapperStyle:p,containerStyle:g}=r(e,m);return(0,o.hi)(()=>{!a.value&&l();const e=!(!d.value||!d.value.getModel)&&d.value.getModel();e&&(e.original.dispose(),e.modified.dispose()),d.value&&d.value.dispose()}),(0,o.wB)([()=>e.originalModelPath,()=>e.original,()=>e.originalLanguage,()=>e.language],([e,t,n,o],[i,l,r,u])=>{if(!m.value)return l;const s=!!d.value&&d.value.getOriginalEditor();if(e!==i){const i=c(a.value||!1,t||"",n||o||"text",e||"");return void(s&&i&&s.setModel(i))}t!==s.getValue()&&s.setValue(t||""),n===r&&o===u||a.value&&d.value&&a.value.editor.setModelLanguage(d.value.getModel().original,n||o||"text")}),(0,o.wB)(()=>e.modifiedModelPath,()=>{if(!a.value||!d.value)return;const t=d.value.getModifiedEditor(),n=c(a.value,e.modified||"",e.modifiedLanguage||e.language||"text",e.modifiedModelPath||"");n&&n!==t.getModel()&&t.setModel(n)}),(0,o.wB)(()=>e.modified,()=>{if(!m.value)return;const t=d.value.getModifiedEditor();t.getOption(a.value.editor.EditorOption.readOnly)?t.setValue(e.modified||""):e.modified!==t.getValue()&&(t.executeEdits("",[{range:t.getModel().getFullModelRange(),text:e.modified||"",forceMoveMarkers:!0}]),t.pushUndoStop())}),(0,o.wB)(()=>e.original,()=>{d.value&&d.value.getModel().original.setValue(e.original||"")}),(0,o.wB)(()=>[e.language,e.originalLanguage,e.modifiedLanguage],()=>{if(!m.value)return;const{original:t,modified:n}=d.valuegetModel();a.value.editor.setModelLanguage(t,e.originalLanguage||e.language||"text"),a.value.editor.setModelLanguage(n,e.originalLanguage||e.language||"text")}),(0,o.wB)(()=>e.theme,()=>{a.value&&a.value.editor.setTheme(e.theme)}),(0,o.wB)(()=>e.options,()=>{d.value&&d.value.updateOptions(e.options)},{deep:!0}),{containerRef:n,isDiffEditorReady:m,isLoadFailed:s,wrapperStyle:p,containerStyle:g}},render(){const{$slots:e,isDiffEditorReady:t,isLoadFailed:n,wrapperStyle:a,containerStyle:i,className:l}=this;return(0,o.h)("div",{style:a},[!t&&(0,o.h)("div",{style:_},n?e.failure?s(e.failure):"load failed":e.default?s(e.default):"loading..."),(0,o.h)("div",{ref:"containerRef",key:"monaco_diff_editor_container",style:i,class:l})])}});function w({emit:e},t,n,a){const l=(0,i.shallowRef)(null);function r(){if(!a.value||!n.value||l.value)return;e("beforeMount",n.value),l.value=n.value.editor.createDiffEditor(a.value,{automaticLayout:!0,autoIndent:"brackets",theme:t.theme,formatOnPaste:!0,formatOnType:!0,...t.options});const o=c(n.value,t.original||"",t.originalLanguage||t.language||"text",t.originalModelPath||""),i=c(n.value,t.modified||"",t.modifiedLanguage||t.language||"text",t.modifiedModelPath||"");o&&i&&l.value&&l.value.setModel({original:o,modified:i}),e("mount",l.value,n.value)}return(0,o.sV)(()=>{const e=(0,o.wB)(n,()=>{a.value&&n.value&&((0,o.dY)(()=>e()),r())},{immediate:!0})}),{diffEditorRef:l}}const x={class:"CustomEditor"},k={class:"editor-block"};function E(e,t,n,a,i,l){const r=(0,o.g2)("FuntionBtns"),u=(0,o.g2)("vue-monaco-editor");return(0,o.uX)(),(0,o.CE)("div",x,[(0,o.bF)(r,{ref:"btnsRef",functionBtns:n.functionBtns,editorRef:a.editorRef},null,8,["functionBtns","editorRef"]),(0,o.Lk)("div",k,[(0,o.bF)(u,{class:"code",modelValue:a.code,"onUpdate:modelValue":t[0]||(t[0]=e=>a.code=e),language:n.language,options:a.options,height:a.editorHeight,theme:n.theme,onMount:a.handleMount,onBeforeMount:a.beforeMount,onUpdate:a.updateValue},null,8,["modelValue","language","options","height","theme","onMount","onBeforeMount","onUpdate"])])])}var L=n(78626),F=n(24232);const M={key:0,class:"function-btn"};function R(e,t,n,a,i,l){const r=(0,o.g2)("el-button"),u=(0,o.g2)("el-tooltip");return a.buttons.length>0?((0,o.uX)(),(0,o.CE)("div",M,[((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(a.buttons,(e,t)=>((0,o.uX)(),(0,o.Wv)(u,{key:t,content:e.content,placement:"top",effect:"dark"},{default:(0,o.k6)(()=>[(0,o.bF)(r,{class:"icon",onClick:e.action},{default:(0,o.k6)(()=>[(0,o.Lk)("i",{class:(0,F.normalizeClass)(e.iconClass)},null,2)]),_:2},1032,["onClick"])]),_:2},1032,["content"]))),128))])):(0,o.Q3)("",!0)}var C={name:"VueMonacaEditorBtns",props:{functionBtns:Array,editorRef:Object},setup(e){const t=(0,o.EW)(()=>e?e.editorRef:null),n=(0,o.EW)(()=>{const t=[{name:"format",content:"格式化",action:a,iconClass:"icon-clear_all"},{name:"copy",content:"複製",action:i,iconClass:"icon-content_copy"},{name:"cut",content:"剪下",action:r,iconClass:"icon-content_cut"},{name:"paste",content:"貼上",action:l,iconClass:"icon-content_paste"},{name:"undo",content:"復原",action:s,iconClass:"icon-undo"},{name:"redo",content:"重做",action:d,iconClass:"icon-redo"},{name:"clear",content:"清空",action:u,iconClass:"icon-cleaning_services"}];return t.filter(t=>e.functionBtns.includes(t.name))}),a=()=>{if(t.value)try{t.value.getAction("editor.action.formatDocument").run()}catch(e){}},i=async()=>{if(t.value){const n=t.value.getValue();try{await navigator.clipboard.writeText(n)}catch(e){}}},l=async()=>{if(t.value)try{const e=await navigator.clipboard.readText();t.value.setValue(e)}catch(e){}},r=async()=>{if(t.value)try{await i(),t.value.setValue("")}catch(e){}},u=async()=>{if(t.value)try{t.value.setValue("")}catch(e){}},s=async()=>{if(t.value)try{t.value.trigger("keyboard","undo",null)}catch(e){}},d=async()=>{if(t.value)try{t.value.trigger("keyboard","redo",null)}catch(e){}};return{buttons:n,formatCode:a,copyText:i,cutText:r,pasteText:l,undo:s,redo:d,clearText:u}}},S=n(71241);const O=(0,S.A)(C,[["render",R]]);var A=O;const V={db:"\n    |B 來源，支援: ['mysql 'mssql 'postgresql 'oracle '_internal']，其中 _internal 為內部資料庫\n  ",sql:"\n    SQL 腳本名稱，教本內容可用動態參數，動態參數要以兩個中括號包覆，例如: {{param}}\n    Examples: \n      - db=_internal sql=sql_script\n  ",op:"\n    Open Search 來源\n  ",index:"\n    DSL 目標之 Index\n    Examples: \n      - op=op index=windows*\n      - op=op index=windows* start=-1h end=now\n      - op=op index=windows* dsl=dsl_script\n  ",ppl:'\n    PPL 腳本名稱\n    Examples:\n      - op=op ppl="source=windows*"\n      - op=op ppl="source=windows*" start=-1h end=now\n      - op=op ppl="source=windows* | stats count() by host"\n  ',prom:"\n    Prometheus 來源\n  ",promql:'\n    PromQL 語法\n    Examples:\n      - prom=prom promql="up"\n      - prom=prom promql="up" start=-5m end=now\n      - prom=prom promql="up" complete=false\n      - prom=prom promql="up" minstep=1 step=10\n  ',splunk:"\n    Splunk 來源\n  ",savesearch:'\n    儲存搜尋名稱\n    Examples:\n      - splunk=sp savesearch="License Usage Data Cube"\n  ',spl:'\n    SPL 語法，同 UI 可選擇性的使用 search 關鍵字，如果 SPL 本身就用到字串，請記得使用跳脫字元\n    Examples:\n      - splunk=sp spl="index="tcs_leave" sourcetype=tcs_leave"\n      - splunk=sp spl="search index="tcs_leave" sourcetype=tcs_leave"\n  ',cache:"\n    將資料儲存至 cache\n    Format: \n      - cache <cache_name> [parent_table] <table_name>\n    Examples:\n      - cache cache_name table_a\n      - cache cache_name parent_table table_a\n  ",dedup:"\n    去除重複資料\n    Format: \n      - dedup <columns> [columns...] [kwargs...]\n    Examples:\n      - dedup column\n      - dedup column1 column2 column3\n      - dedup column1 column2 n=2\n      - dedup column1 column2 n=10 keepempty=true\n  ",eval:"\n    根據給定的表達式進行欄位運算和操作，包含新增欄位、修改欄位等\n    Format: \n      - eval <expression>\n    Examples:\n      - eval a = price * 2\n      - eval a = pow(price), b = abs(column)\n      - eval a = col_x * 2 + (col_b - 5)\n  ",fields:"\n    保留特定欄位\n    Format: \n      - fields <columns> [columns...]\n    Examples:\n      - fields col_a\n      - fields col_a col_b col_c\n  ",filter:"\n    根據給定欄位和條件過濾資料\n    Format: \n      - filter <expression>\n    Examples:\n      - filter column > 10\n      - filter a > 1 and b < 2\n  ",flatten:"\n    將特定欄位的資料展平至其他欄位\n    Format: \n      - flatten <columns> [columns...]\n    Examples:\n      - flatten col_a\n      - flatten col_a col_b col_c\n  ",head:"\n    取得前 n 筆資料\n    Format: \n      - head [n]\n    Examples:\n      - head\n      - head 1\n  ",innerjoin:"\n    根據子查詢結果，進行 Inner Join 連接資料\n    Format: \n      - join L.<left_column> == R.<right_column> <[subquery]>\n      - innerjoin L.<left_column> == R.<right_column> <[subquery]>\n    Examples:\n      - join L.id == R.id [另一個 cmd 語法]\n      - innerjoin L.id == R.id [另一個 cmd 語法]\n  ",join:"\n    根據子查詢結果，進行 Inner Join 連接資料\n    Format: \n      - join L.<left_column> == R.<right_column> <[subquery]>\n      - innerjoin L.<left_column> == R.<right_column> <[subquery]>\n    Examples:\n      - join L.id == R.id [另一個 cmd 語法]\n      - innerjoin L.id == R.id [另一個 cmd 語法]\n  ",leftjoin:"\n    與子查詢結果，進行 Left Join 連接資料\n    Format: \n      - leftjoin L.<left_column> == R.<right_column> <[subquery]>\n    Examples:\n      - leftjoin L.id == R.id [另一個 cmd 語法]\n  ",mom:"\n    月增長率比較\n    Format: \n      - mom <datetime_column> <compare_column>\n    Examples:\n      - mom timestamp col\n  ",outerjoin:"\n    根據子查詢結果，進行 Outer Join 連接資料\n    Format: \n      - outerjoin L.<left_column> == R.<right_column> <[subquery]>\n    Examples:\n      - outerjoin L.id == R.id [另一個 cmd 語法]\n  ",rename:"\n    重新命名欄位\n    Format: \n      - rename <old_name> <new_name>\n    Examples:\n      - rename old new\n  ",rightjoin:"\n    根據子查詢結果，進行 Right Join 連接資料\n    Format: \n      - rightjoin L.<left_column> == R.<right_column> <[subquery]>\n    Examples:\n      - rightjoin L.id == R.id [另一個 cmd 語法]\n  ",sort:"\n    排序資料\n    Format: \n      - sort <column> [type]\n    Examples:\n      - sort col\n      - sort col asc\n      - sort col desc\n  ",stats:"\n    對資料進行聚合運算。注意: 這會改變資料的結構\n    Format: \n      - stats <operation> [operation...] as [as_column] by <by_column> [by_column...]\n    Examples:\n      - stats count\n      - stats count(id)\n      - stats count(id) as count_id\n      - stats count(id) by class\n      - stats count(id) by store, class\n      - stats count(id), sum(price), avg(price) by store, class\n      - stats count(id), sum(price) as s_p, avg(price) as a_p by store, class\n  ",subsearch:"\n    根據子查詢結果篩選資料\n    Format: \n      - subsearch L.<left_column> <operator> R.<right_column> <[subquery]>\n    Examples:\n      - subsearch L.id == R.id [另一個 cmd 語法]\n      - subsearch L.id != R.id [另一個 cmd 語法]\n      - subsearch L.id > R.id [另一個 cmd 語法]\n      - subsearch L.id >= R.id [另一個 cmd 語法]\n      - subsearch L.id < R.id [另一個 cmd 語法]\n      - subsearch L.id <= R.id [另一個 cmd 語法]\n  ",tsr:'\n    根據時間補齊資料\n    Format: \n      - tsr <date_column> <span> [kwargs...]\n    Examples:\n      - tsr column 2m\n      - tsr column 1d fill=0\n      - tsr column 1day fill=""\n  ',timewrap:"\n    時間序列資料\n    Format: \n      - timewrap <span> <datetime_column> <columns> [columns...]\n    Examples:\n      - timewrap 1d @timestamp col1\n      - timewrap 2w @timestamp col1 col2 col3\n      - timewrap 1mon @timestamp __all__\n  ",top:"\n    只取得指定欄位組合並計數，最後列出計數最大的前 n 筆資料 (意同 COUNT(*) GROUP BY <columns> LIMIT <n>)\n    Format: \n      - top <n> <columns> [columns...]\n    Examples:\n      - top 10 col1\n      - top 10 col1 col2 col3\n  ",yoy:"\n    年增長率比較\n    Format: \n      - yoy <datetime_column> <compare_column> [year]\n    Examples:\n      - yoy timestamp col\n      - yoy timestamp col 5\n  "};n(44114),n(7588),n(61701);var j=n(55129),B=n(6656);function q(e){const t=(0,o.EW)(()=>j.A.state.prometheus.nameList),n=(0,i.ref)(""),a=(0,i.ref)({}),l=()=>{0===t.value.length&&j.A.dispatch("prometheus/getNameList");const o=(t,n)=>{const a=Object.keys(t).map(t=>({label:t,kind:e.value.languages.CompletionItemKind.Text,insertText:t,range:n}));return a};e.value.languages.registerCompletionItemProvider("cmd",{triggerCharacters:["{","=","~"],provideCompletionItems:function(i,l){return new Promise(r=>{const u=i.getWordUntilPosition(l),s={startLineNumber:l.lineNumber,endLineNumber:l.lineNumber,startColumn:u.startColumn,endColumn:u.endColumn},d=i.getValue(),c=new RegExp(/[a-zA-z_]+{+([a-zA-z_]?)+(=?|=~?)+([a-zA-z_]?)+(}?)/).test(d);if(c){const i=d.split("{")[0],l=t.value.find(e=>e===i);if(l||r({suggestions:[]}),l!==n.value)B.A.getLable({"match[]":l}).then(t=>{const i={};t.data.forEach(e=>{Object.keys(e).forEach(t=>{if(i[t]){const n=i[t].findIndex(n=>n===e[t]);-1===n&&i[t].push(e[t])}else i[t]=[e[t]]})}),a.value=i,n.value=l;const u=d.match(/{+[a-zA-z_]+(=?|=~?)+(.?)+(}?)/);let c="";u&&u[0]&&(c=u[0].indexOf("=")>-1?u[0].split("=")[0].replace("{","").replace("=",""):u[0].replace("{","").replace("}",""));const m=Object.keys(a.value).find(e=>e===c);if(new RegExp(/[a-zA-z_]+{+[a-zA-Z_]+(=|=~)+([a-zA-Z_]?)+(}?)/).test(d)&&m){const t=d.match(/{+[a-zA-Z_]+=/),n=t?t[0].replace("{","").replace("=",""):"",o=n?a.value[n].map(t=>({label:t,kind:e.value.languages.CompletionItemKind.Text,insertText:t,range:s})):[];r({suggestions:o})}else new RegExp(/[a-zA-z_]+{+[a-zA-Z_]+(=?)+}/).test(d)&&m?r({suggestions:["=","=~"].map(t=>({label:t,kind:e.value.languages.CompletionItemKind.Text,insertText:t,range:{startLineNumber:s.startLineNumber,endLineNumber:s.endLineNumber,startColumn:s.startColumn-1,endColumn:s.endColumn}}))}):r({suggestions:o(a.value,s)})}).catch(()=>{a.value={},n.value=l});else{const t=d.match(/{+[a-zA-z_]+(=?|=~?)+(.?)+(}?)/);let n="";t&&t[0]&&(n=t[0].indexOf("=")>-1?t[0].split("=")[0].replace("{","").replace("=",""):t[0].replace("{","").replace("}",""));const i=Object.keys(a.value).find(e=>e===n);if(new RegExp(/[a-zA-z_]+{+[a-zA-Z_]+(=|=~)+([a-zA-Z_]?)+(}?)/).test(d)&&i){const t=d.match(/{+[a-zA-Z_]+=/),n=t?t[0].replace("{","").replace("=",""):"",o=n?a.value[n].map(t=>({label:t,kind:e.value.languages.CompletionItemKind.Text,insertText:t,range:s})):[];r({suggestions:o})}else new RegExp(/[a-zA-z_]+{+[a-zA-Z_]+(=?)+}/).test(d)&&i?r({suggestions:["=","=~"].map(t=>({label:t,kind:e.value.languages.CompletionItemKind.Text,insertText:t,range:{startLineNumber:s.startLineNumber,endLineNumber:s.endLineNumber,startColumn:s.startColumn-1,endColumn:s.endColumn}}))}):r({suggestions:o(a.value,s)})}}else r({suggestions:t.value.map(t=>({label:t,kind:e.value.languages.CompletionItemKind.Text,insertText:t,range:s}))})})}})};return{setupKeyword:l}}const T={pipe:["cache","dedup","eval","fields","filter","flatten","head","join","innerjoin","leftjoin","mom","outerjoin","rename","rightjoin","sort","stats","subsearch","tsr","timewrap","top","yoy"],source:["db","op","prom","splunk"],query:["sql","ppl","promql","index","spl","savesearch"],extra:["start","end","dsl","filter","step","minstep","complete"]},N={keyword_pipe:{light:"#01B468",dark:"#2FFEA8"},keyword_source:{light:"#C229B5",dark:"#F76EEC"},keyword_query:{light:"#FF6D33",dark:"#FF9166"},keyword_extra:{light:"#0080FF",dark:"#94C9FF"},editor_foreground:{light:"#000000",dark:"#FFFFFF"},editor_background:{light:"#FFFFFF",dark:"#1E1E1E"},editor_cursor_foreground:{light:"#000000",dark:"#FFFFFF"},editor_line_highlight_background:{light:"#F0F0F0",dark:"#2B2B2B"},editor_line_number_foreground:{light:"#858585",dark:"#858585"},editor_selection_background:{light:"#E0E0E0",dark:"#264F78"},editor_inactive_selection_background:{light:"#FFFFFF",dark:"#3A3D41"},theme:{light:"vs",dark:"vs-dark"}},z=e=>{const t="vs"===e.theme?"light":"dark";return{base:e.theme,inherit:!0,rules:[{token:"keyword-pipe",foreground:N.keyword_pipe[t]},{token:"keyword-source",foreground:N.keyword_source[t]},{token:"keyword-query",foreground:N.keyword_query[t]},{token:"keyword-extra",foreground:N.keyword_extra[t]}],colors:{"editor.foreground":N.editor_foreground[t],"editor.background":N.editor_background[t],"editorCursor.foreground":N.editor_cursor_foreground[t],"editor.lineHighlightBackground":N.editor_line_highlight_background[t],"editorLineNumber.foreground":N.editor_line_number_foreground[t],"editor.selectionBackground":N.editor_selection_background[t],"editor.inactiveSelectionBackground":N.editor_inactive_selection_background[t]}}},I=(e,t)=>{const n=Object.assign(V,t.cmdDoc);return n[e]?{label:`${e}`,documentation:n[e]}:null},P=(e,t)=>{e.languages.registerHoverProvider("cmd",{provideHover:function(n,a){const o=n.getWordAtPosition(a);if(o&&o.word){const n=I(o.word,t);if(n)return{range:new e.Range(a.lineNumber,o.startColumn,a.lineNumber,o.endColumn),contents:[{value:`**${n.label}**`},{value:n.documentation}]}}return null}})},D=e=>{try{const t=e.join("|");return t}catch(t){console.error(t)}};function H(e,t){const n=Object.assign(T,e.cmdKeywords),{pipe:a,source:l,query:r,extra:u}=n,{minHeight:s,maxHeight:d}=e.dynamicHeightLimitation,c=(0,i.ref)(e.enableDynamicHeight?`${s}px`:"100%"),m=()=>{const e={pipe:D(a),source:D(l),query:D(r),extra:D(u)};return e},p=(0,i.ref)(null),{setupKeyword:g}=q(p),f=(0,o.EW)(()=>e.editorOptions&&e.editorOptions.padding?e.editorOptions.padding.top+e.editorOptions.padding.bottom:0),v=()=>{const e=m();return{keywords_source:l,keywords_query:r,tokenizer:{root:[{include:"@quotedIdentifier"},{include:"@pipe"},{include:"@source"},{include:"@query"},{include:"@extra"},[/[\w]+/,{cases:{"@keywords_source":"keyword-source","@keywords_query":"keyword-query","@default":"identifier"}}]],quotedIdentifier:[[/"([^"]*)"/,"identifier"]],pipe:[[new RegExp(`\\|\\s*(${e.pipe})\\b`),"keyword-pipe"]],source:[[new RegExp(`^(${e.source})\\b`),"keyword-source"],[new RegExp(`\\s+(${e.source})\\b`),"keyword-source"]],query:[[new RegExp(`^(${e.query})\\b`),"keyword-query"],[new RegExp(`\\s+(${e.query})\\b`),"keyword-query"]],extra:[[new RegExp(`^(${e.extra})\\b`),"keyword-extra"],[new RegExp(`\\s+(${e.extra})\\b`),"keyword-extra"]]}}},h=n=>{if(e.enableDynamicHeight&&t.value){const e=t.value.getModel(),a=t.value.getLayoutInfo(),o=a.contentWidth,i=t.value.getOption(p.value.editor.EditorOption.lineHeight);let l=f.value??0;if(n){const n=e.getLineCount();for(let a=1;a<=n;a++){const n=e.getLineContent(a),r=t.value.getOption(p.value.editor.EditorOption.fontInfo).typicalHalfwidthCharacterWidth,u=r*n.length;let s=Math.ceil(u/o);s=0===s?1:s,l+=s*i}l=Math.max(l,s),c.value=l>d?`${d}px`:`${l}px`}else c.value=`${s}px`}},y=t=>{p.value=t,("cmd"===e.language&&!t.languages||t.languages.getEncodedLanguageId("cmd")<1)&&(t.languages.register({id:"cmd"}),t.languages.setMonarchTokensProvider("cmd",v()),t.editor.defineTheme(e.theme,z(e)),P(t,e),g()),h(!1)};return{beforeMount:y,updateEditorHeight:h,editorHeight:c}}var $={name:"CustomEditor",components:{FuntionBtns:A},props:{modelValue:{type:String,required:!0},theme:{type:String,default:"vs"},editorOptions:{type:Object,default:()=>null},readOnly:{type:Boolean,default:!1},language:{type:String,default:"json"},functionBtns:{type:Array,default:()=>[]},cmdKeywords:Object,cmdDoc:Object,enableDynamicHeight:{type:Boolean,default:!1},dynamicHeightLimitation:{type:Object,default:()=>({minHeight:32,maxHeight:300})}},emits:["update","update:modelValue","mount"],setup(e,{emit:t}){const n=(0,o.EW)(()=>e.modelValue),a=(0,i.ref)(n.value),l=(0,i.shallowRef)(null),r=(0,i.shallowRef)(null),u=(0,i.shallowRef)(null),s=(0,i.ref)(!1),d=(0,o.EW)(()=>e.enableDynamicHeight),{beforeMount:c,updateEditorHeight:m,editorHeight:p}=H(e,l),g={automaticLayout:!0,formatOnType:!0,formatOnPaste:!0,scrollBeyondLastLine:!1};e.editorOptions&&Object.assign(g,e.editorOptions);const f=async e=>{l.value.setValue(e),await l.value.getAction("editor.action.formatDocument").run()},v=async(n,o)=>{try{l.value=n,r.value=o,await f(a.value),await l.value.updateOptions({...g,readOnly:e.readOnly}),d.value?(n.onDidFocusEditorText(()=>{s.value=!0,m(s.value)}),n.onDidBlurEditorText(()=>{s.value=!1,m(s.value)}),m(s.value)):(n.onDidFocusEditorText(()=>{s.value=!0}),n.onDidBlurEditorText(()=>{s.value=!1})),t("mount",n,o)}catch(i){}},h=(0,L.debounce)(function(e){t("update",e),t("update:modelValue",e)},1e3,{leading:!1,trailing:!0}),y=function(e){d.value&&m(s.value),h(e)};return(0,o.wB)(n,(e,t)=>{l.value&&!t&&e&&!s.value&&f(e)}),{editorRef:l,handleMount:v,updateValue:y,reFormat:f,btnsRef:u,code:a,options:g,beforeMount:c,editorHeight:p}}};n(3469);const W=(0,S.A)($,[["render",E]]);var K=W,U=K;function Z(e,t){t&&a.A.config(t),e.component(v.name,v),e.component(b.name,b),e.component(U.name,U)}var J=Z}}]);